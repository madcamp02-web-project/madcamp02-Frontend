# ğŸ“ MadCamp02: ìµœì¢… í†µí•© ëª…ì„¸ì„œ

**Ver 2.7.14 - Complete Edition (Spec-Driven Alignment)**

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë²„ì „      | ë‚ ì§œ           | ë³€ê²½ ë‚´ìš©                                                                                            | ì‘ì„±ì        |
| --------- | -------------- | ---------------------------------------------------------------------------------------------------- | ------------- |
| 1.0       | 2026-01-15     | ì´ˆê¸° ëª…ì„¸ì„œ ì‘ì„±                                                                                     | MadCamp02     |
| 2.0       | 2026-01-16     | í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ í†µí•© ëª…ì„¸ ì™„ì„±                                                                     | MadCamp02     |
| 2.1       | 2026-01-17     | Exception êµ¬ì¡° ì •ë¦¬, ErrorResponse DTO ì¶”ê°€                                                          | MadCamp02     |
| 2.2       | 2026-01-17     | ì¹´ì¹´ì˜¤ OAuth, ì¼ë°˜ íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì¶”ê°€                                                              | MadCamp02     |
| 2.3       | 2026-01-17     | OAuth2 ë°±ì—”ë“œ ì£¼ë„ ë°©ì‹ìœ¼ë¡œ ë³€ê²½                                                                     | MadCamp02     |
| 2.4       | 2026-01-17     | í”„ë¡ íŠ¸ì—”ë“œ í˜„ì¬ êµ¬í˜„ ìƒíƒœ ë¶„ì„ ë° ëˆ„ë½ í•­ëª© ì •ë¦¬                                                     | MadCamp02     |
| 2.5       | 2026-01-18     | ì‹¤ì œ êµ¬í˜„ëœ í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€(Market, Shop, Trade) ëª…ì„¸ ê³µì‹í™”                                       | MadCamp02     |
| **2.6**   | **2026-01-18** | **í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦ ì•„í‚¤í…ì²˜(Frontend/Backend Driven) ë°˜ì˜**                                           | **MadCamp02** |
| **2.7**   | **2026-01-18** | **ì •í•©ì„± ê¸°ì¤€ ê³ ì • ë° ì—”ë“œí¬ì¸íŠ¸/ìš©ì–´ ë¬¸êµ¬ ì •ë¦¬(ë¼ìš°íŠ¸/ì‹¤ì‹œê°„/ì¸ì¦)**                                | **MadCamp02** |
| **2.7.1** | **2026-01-18** | **Phase 0: ì‘ë‹µ DTO(ìµœì†Œ í•„ë“œ) ê·œì•½/ì˜ˆì‹œ JSON ì¶”ê°€ + STOMP ì—”ë“œí¬ì¸íŠ¸(`/ws-stomp`) ì •í•©ì„± ê³ ì •**     | **MadCamp02** |
| **2.7.2** | **2026-01-18** | **í…ŒìŠ¤íŠ¸ ê²½ë¡œ ì •ê·œí™”(src/test/java) ë°˜ì˜ ë° CI/CD ë‹¨ê³„ì˜ í…ŒìŠ¤íŠ¸ ì „ëµ(í›„ì†) ëª…ì‹œ**                    | **MadCamp02** |
| **2.7.3** | **2026-01-18** | **Phase 1: `items.category` ë ˆê±°ì‹œâ†’ëª©í‘œ ë§¤í•‘ í‘œ ë° Unknown ê°’ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨(raise) ì •ì±… ê³ ì •**   | **MadCamp02** |
| **2.7.4** | **2026-01-18** | **Phase 2 í™•ì¥: ì •ë°€ ì‚¬ì£¼ ê³„ì‚°(ì„±ë³„/ì–‘ë ¥ìŒë ¥/ì‹œê°„ í¬í•¨) ë° íƒ€ì¸ í”„ë¡œí•„ ê³µê°œ API DTO ë¶„ë¦¬**           | **MadCamp02** |
| **2.7.5** | **2026-01-18** | **Phase 2 ì™„ì„±: ì›”ì£¼/ì‹œì£¼ ê³„ì‚° êµ¬í˜„, í•œêµ­ì²œë¬¸ì—°êµ¬ì› API ì—°ë™(ì–‘ë ¥â†”ìŒë ¥ ë³€í™˜), ì‹œê°„ ê¸°ë³¸ê°’ 00:00:00** | **MadCamp02** |
| **2.7.6** | **2026-01-19** | **ë°ì´í„° ì „ëµ ë°˜ì˜: EODHD + DB ìºì‹±, WebSocket êµ¬ë… ê´€ë¦¬(LRU), API ì œí•œ ë° ì—ëŸ¬ ì²˜ë¦¬ ëª…ì‹œ**         | **MadCamp02** |
| **2.7.7** | **2026-01-19** | **EODHD ë¬´ë£Œ êµ¬ë… ì œí•œ(ìµœê·¼ 1ë…„) ì£¼ì˜ì‚¬í•­ ì¶”ê°€, ì™¸ë¶€ API í™•ì¥ ì „ëµ(13.3) ì¶”ê°€** | **MadCamp02** |
| **2.7.8** | **2026-01-19** | **ì§€ìˆ˜ ì¡°íšŒë¥¼ ETFë¡œ ë³€ê²½ (Finnhub Quote APIëŠ” ì§€ìˆ˜ ì‹¬ë³¼ ë¯¸ì§€ì›) - SPY, QQQ, DIA ì‚¬ìš©** | **MadCamp02** |
| **2.7.9** | **2026-01-19** | **Phase 4: Trade/Portfolio Engine ì™„ì „ êµ¬í˜„ ë° ë¬¸ì„œ í†µí•© (íŠ¸ëœì­ì…˜/ë½ ì „ëµ, ë‹¤ì´ì–´ê·¸ë¨ í¬í•¨)** | **MadCamp02** |
| **2.7.10** | **2026-01-19** | **Phase 5: Game/Shop/Ranking API êµ¬í˜„ ì™„ë£Œ (ê°€ì± /ì¸ë²¤í† ë¦¬/ì¥ì°©/ë­í‚¹)** | **MadCamp02** |
| **2.7.11** | **2026-01-19** | **í”„ë¡ íŠ¸ 2.7.11 ìŠ¤ëƒ…ìƒ· ë°˜ì˜: Phase 5 ì™„ë£Œ ê¸°ë°˜ â€œPhase 5.5: í”„ë¡ íŠ¸ ì—°ë™Â·DB ì œì•½ ë³´ê°•â€ ì¶”ê°€(Shop/Gacha/Inventory/Ranking ì‹¤ë°ì´í„° ì „í™˜ ì²´í¬ë¦¬ìŠ¤íŠ¸, `{items:[]}`Â·ì¹´í…Œê³ ë¦¬/ETF/STOMP ì •í•©ì„± ì¬í™•ì¸)** | **MadCamp02** |
| **2.7.12** | **2026-01-19** | **Phase 5.5 ì‹¤í–‰: `/api/v1/game/*` ì‘ë‹µ DTO/ì—ëŸ¬ ì½”ë“œ(GAME_001~003)Â·items.category CHECK ì œì•½Â·ë­í‚¹ í•„í„°(is_ranking_joined) êµ¬í˜„ ìƒíƒœë¥¼ ìŠ¤í™ê³¼ ìµœì¢… ì •í•©í™”** | **MadCamp02** |
| **2.7.13** | **2026-01-19** | **Phase 6: ì‹¤ì‹œê°„ í†µì‹ (10ì¥) ì¶”ê°€ - STOMP í† í”½/payload ìŠ¤í‚¤ë§ˆ, Finnhub WebSocket ì œì•½ì‚¬í•­, ticker destination ì•ˆì „ì„± ì •ì±… ê³ ì • (FinnhubTradesWebSocketClient/TradePriceBroadcastService/StompDestinationUtils ê¸°ì¤€)** | **MadCamp02** |
| **2.7.14** | **2026-01-19** | **Phase 3.6: ë°±ì—”ë“œ Redis ìºì‹± í™•ì¥ (Market Indices/News/Movers) ë° í”„ë¡ íŠ¸ì—”ë“œ ì´ì¤‘ ìºì‹± ì „ëµ ìˆ˜ë¦½** | **MadCamp02** |

### Ver 2.6 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì¸ì¦ ì•„í‚¤í…ì²˜ ìœ ì—°í™”**: ë‹¤ì–‘í•œ í´ë¼ì´ì–¸íŠ¸(Web, Mobile App) ì§€ì›ì„ ìœ„í•´ **í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦ ë°©ì‹**ì„ ê³µì‹ ì±„íƒí–ˆìŠµë‹ˆë‹¤.
    - **Web**: ë³´ì•ˆì„±ì´ ë†’ì€ Backend-Driven (Redirect) ë°©ì‹ ê¶Œì¥.
    - **App/SPA**: ì‚¬ìš©ì ê²½í—˜ì´ ë§¤ë„ëŸ¬ìš´ Frontend-Driven (Token API) ë°©ì‹ ì§€ì›.

### Ver 2.7 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì •í•©ì„± ê¸°ì¤€(Single Source of Truth) ê³ ì •**: ë³¸ ë¬¸ì„œì™€ ê°œë°œ ê³„íšì„œ(`FRONTEND_DEVELOPMENT_PLAN`, `BACKEND_DEVELOPMENT_PLAN`)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ êµ¬í˜„ì„ ë™ê¸°í™”.
2.  **Frontend êµ¬í˜„ í˜„í™© í‘œí˜„ ì •ë¦¬**: â€œì‹¤ì œ êµ¬í˜„ ë°˜ì˜â€ì´ë¼ê³  ë‹¨ì •ëœ í•­ëª© ì¤‘, í˜„ ì‹œì  ì½”ë“œì™€ ë¶ˆì¼ì¹˜í•˜ëŠ” ë¼ìš°íŠ¸/ì‹¤ì‹œê°„/ì¸ì¦ í‘œí˜„ì„ **êµ¬í˜„ ì˜ˆì •(Phase 1~3)**ìœ¼ë¡œ ì •ë¦¬.

### Ver 2.7.1 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì‘ë‹µ DTO ê·œì•½ ê³ ì •(í”„ë¡ íŠ¸ ì—°ë™ ì„ í–‰)**: ë¦¬ìŠ¤íŠ¸ ì‘ë‹µì˜ í™•ì¥ì„±ì„ ìœ„í•´ `items` íŒ¨í„´ì„ ì±„íƒí•˜ê³ , Market/Portfolio/Inventory/Rankingì˜ **ìµœì†Œ í•„ë“œ ìŠ¤í‚¤ë§ˆ + ì˜ˆì‹œ JSON**ì„ ëª…ì‹œ.
2.  **ì‹¤ì‹œê°„(STOMP) ì—”ë“œí¬ì¸íŠ¸ ì •í•©ì„± ê³ ì •**: ë¬¸ì„œ ê¸°ì¤€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ `/ws-stomp`ë¡œ ê³ ì •(ë°±ì—”ë“œ ë³´ì•ˆ ì˜ˆì™¸/ì„¤ì •ì€ ì½”ë“œì—ì„œ ë°˜ì˜).

### Ver 2.7.2 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **CIì—ì„œ í…ŒìŠ¤íŠ¸ â€œì‹¤í–‰â€ ì •í•©ì„±**: í…ŒìŠ¤íŠ¸ ê²½ë¡œë¥¼ í‘œì¤€(`src/test/java`)ë¡œ ì •ê·œí™”í•˜ì—¬ Gradle/CIê°€ í…ŒìŠ¤íŠ¸ë¥¼ íƒì§€í•  ìˆ˜ ìˆëŠ” ì „ì œë¥¼ ê³ ì •.
2.  **í†µí•© í…ŒìŠ¤íŠ¸ ì „ëµ(í›„ì†)**: Postgres/Redis/Flyway ì˜ì¡´ í†µí•© í…ŒìŠ¤íŠ¸ëŠ” CI/CD ë‹¨ê³„ì—ì„œ â€œì„œë¹„ìŠ¤ ì»¨í…Œì´ë„ˆ ì¶”ê°€â€ ë˜ëŠ” â€œí…ŒìŠ¤íŠ¸ í”„ë¡œíŒŒì¼/ì»¨í…Œì´ë„ˆ ì „ëµâ€ ì¤‘ í•˜ë‚˜ë¡œ ê³ ì •(ì„¸ë¶€ëŠ” ë°±ì—”ë“œ ê°œë°œ ê³„íšì„œ Phase 8 ì°¸ì¡°).

### Ver 2.7.3 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **`items.category` ì •í•©ì„± ì •ì±…(Fail Fast) ê³ ì •**: ë ˆê±°ì‹œâ†’ëª©í‘œ ì¹´í…Œê³ ë¦¬ ë§¤í•‘ í‘œë¥¼ ëª…ì‹œí•˜ê³ , Unknown ê°’ì´ ë‚¨ì•„ìˆìœ¼ë©´ Flyway V3 ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤íŒ¨(raise)ì‹œì¼œ ë°°í¬ë¥¼ ì°¨ë‹¨.

### Ver 2.7.4 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì •ë°€ ì‚¬ì£¼ ê³„ì‚° í™•ì¥**: Phase 2ì—ì„œ ì„±ë³„(`gender`), ì–‘ë ¥/ìŒë ¥ êµ¬ë¶„(`calendar_type`), ìƒë…„ì›”ì¼ì‹œ(`birth_time`)ê¹Œì§€ í¬í•¨í•œ ì •ë°€ ì‚¬ì£¼ ê³„ì‚°ìœ¼ë¡œ í™•ì¥. `users` í…Œì´ë¸”ì— `birth_time`(TIME), `gender`(VARCHAR), `calendar_type`(VARCHAR) ì»¬ëŸ¼ ì¶”ê°€ (Flyway V4).
2.  **íƒ€ì¸ í”„ë¡œí•„ ê³µê°œ API DTO ë¶„ë¦¬**: `UserMeResponse`(ë‚´ ì •ë³´, email í¬í•¨)ì™€ `UserPublicResponse`(íƒ€ì¸ ì •ë³´, email ì œì™¸)ë¥¼ ë¶„ë¦¬í•˜ì—¬ ë³´ì•ˆ ê°•í™”.

### Ver 2.7.5 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **4ì£¼(å››æŸ±) ì™„ì „ êµ¬í˜„**: ì—°ì£¼/ì›”ì£¼/ì¼ì£¼/ì‹œì£¼ ëª¨ë‘ ê³„ì‚°í•˜ì—¬ ì •ë°€ ì‚¬ì£¼ ì‚°ì¶œ. ìµœì¢… ì˜¤í–‰ì€ ì¼ì£¼(æ—¥æŸ±)ì˜ ì²œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ë„ì¶œ.
2.  **í•œêµ­ì²œë¬¸ì—°êµ¬ì› API ì—°ë™**: ê³µê³µë°ì´í„°í¬í„¸ì˜ "í•œêµ­ì²œë¬¸ì—°êµ¬ì›\_ìŒì–‘ë ¥ ì •ë³´" APIë¥¼ í†µí•©í•˜ì—¬ ì–‘ë ¥â†”ìŒë ¥ ì •í™•í•œ ë³€í™˜ ì§€ì›.
3.  **ì‹œê°„ ê¸°ë³¸ê°’ ë³€ê²½**: ìƒë…„ì›”ì¼ì‹œ ëª¨ë¥¼ ê²½ìš° ê¸°ë³¸ê°’ì„ `12:00:00`ì—ì„œ `00:00:00`ìœ¼ë¡œ ë³€ê²½.

### Ver 2.7.6 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ë°ì´í„° ì „ëµ ìˆ˜ë¦½**: `docs/DATA_STRATEGY_PLAN.md` ê¸°ë°˜ìœ¼ë¡œ ë¬´ë£Œ API ì œí•œ(Finnhub Premium, EODHD ì¼ì¼ 20íšŒ) ê·¹ë³µ ì „ëµ ìˆ˜ë¦½.
2.  **EODHD + DB ìºì‹±**: Historical Candles ë°ì´í„°ë¥¼ DBì— ì €ì¥í•˜ê³  API ì‘ë‹µì€ í•­ìƒ DBì—ì„œ ì œê³µ. Quota ê´€ë¦¬ ë¡œì§ ì¶”ê°€.
3.  **WebSocket êµ¬ë… ê´€ë¦¬**: Finnhub 50 Symbols ì œí•œ ëŒ€ì‘ì„ ìœ„í•œ Dynamic Subscription Manager (LRU ê¸°ë°˜) ì „ëµ ëª…ì‹œ.
4.  **API ì œí•œ ë° ì—ëŸ¬ ì²˜ë¦¬**: Quota ì´ˆê³¼ ì‹œ Case A(ê¸°ì¡´ ë°ì´í„° ë°˜í™˜ + Stale í‘œì‹œ) ë˜ëŠ” Case B(429 ì—ëŸ¬) ë¶„ê¸° ì²˜ë¦¬ ëª…ì‹œ.

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#2-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [ê¸°ìˆ  ìŠ¤íƒ](#3-ê¸°ìˆ -ìŠ¤íƒ)
4. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#4-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
5. [API ëª…ì„¸](#5-api-ëª…ì„¸)
6. [í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°](#6-í”„ë¡ íŠ¸ì—”ë“œ-êµ¬ì¡°)
7. [í•µì‹¬ ê¸°ëŠ¥ ìƒì„¸](#7-í•µì‹¬-ê¸°ëŠ¥-ìƒì„¸)
8. [ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜ ì‹œìŠ¤í…œ](#8-ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜-ì‹œìŠ¤í…œ)
9. [AI ì‹œìŠ¤í…œ](#9-ai-ì‹œìŠ¤í…œ)
10. [ì‹¤ì‹œê°„ í†µì‹ ](#10-ì‹¤ì‹œê°„-í†µì‹ )
11. [ë³´ì•ˆ ë° ì¸ì¦](#11-ë³´ì•ˆ-ë°-ì¸ì¦)
12. [ë°°í¬ ì „ëµ](#12-ë°°í¬-ì „ëµ)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 í”„ë¡œì íŠ¸ ì •ë³´

| í•­ëª©            | ë‚´ìš©                                                 |
| --------------- | ---------------------------------------------------- |
| **í”„ë¡œì íŠ¸ëª…**  | MadCamp02                                            |
| **ìŠ¬ë¡œê±´**      | "ì°¨íŠ¸ëŠ” ìš´ëª…ì„ ë§í•˜ê³ , ìˆ˜ìµì€ ì•„ë°”íƒ€ë¥¼ ì¶¤ì¶”ê²Œ í•œë‹¤." |
| **ë²„ì „**        | 2.0                                                  |
| **íƒ€ê²Ÿ í”Œë«í¼** | Web (Desktop ìš°ì„ , ëª¨ë°”ì¼ ë°˜ì‘í˜•)                    |

### 1.2 í”„ë¡œì íŠ¸ ì •ì˜

Finnhub ì‹¤ì‹œê°„ ì£¼ê°€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, **ì‚¬ìš©ìì˜ íˆ¬ì ì„±ê³¼ì™€ ì‚¬ì£¼(Saju)ê°€ ê²°í•©ë˜ì–´ ì•„ë°”íƒ€ì™€ ìƒí˜¸ì‘ìš©**í•˜ëŠ” RPGí˜• ì›¹ ëª¨ì˜íˆ¬ì í”Œë«í¼.

### 1.3 í•µì‹¬ ì°¨ë³„ì 

1. **Narrative (ì„œì‚¬):** ë”±ë”±í•œ ì£¼ì‹ì„ 'ìš´ì„¸'ì™€ 'ìºë¦­í„°'ë¡œ í’€ì–´ëƒ„
2. **Gamification (ê²Œì„í™”):** íˆ¬ì ìˆ˜ìµ â†’ ê²Œì„ ì½”ì¸ â†’ ê°€ì±  â†’ ì•„ë°”íƒ€ ì»¤ìŠ¤í„°ë§ˆì´ì§•
3. **Tech (ê¸°ìˆ ):** RDBMSì˜ ì•ˆì •ì„± + Redisì˜ ì†ë„ + Gen-AIì˜ ì°½ì˜ì„±ì„ ê²°í•©í•œ í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜
4. **Personalization (ê°œì¸í™”):** ì‚¬ì£¼/ë³„ìë¦¬ ê¸°ë°˜ ë§ì¶¤í˜• íˆ¬ì ì¡°ì–¸

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 2.1 ì „ì²´ êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  React (Next.js 16) + TypeScript + Tailwind CSS             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Zustand (ìƒíƒœ ê´€ë¦¬)                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ STOMP.js (WebSocket)                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Lightweight Charts (ìº”ë“¤ ì°¨íŠ¸)                          â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Shadcn/UI (ì»´í¬ë„ŒíŠ¸)                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    HTTPS / WSS (TLS 1.3)
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APPLICATION LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Spring Boot 3.4     â”‚    â”‚  FastAPI (Python)    â”‚           â”‚
â”‚  â”‚  (Core Server)       â”‚â—„â”€â”€â”€â”‚  (AI Server)         â”‚           â”‚
â”‚  â”‚  â”œâ”€â”€ REST API        â”‚    â”‚  â”œâ”€â”€ LLM Inference   â”‚           â”‚
â”‚  â”‚  â”œâ”€â”€ WebSocket       â”‚    â”‚  â”œâ”€â”€ Stable Diffusionâ”‚           â”‚
â”‚  â”‚  â”œâ”€â”€ OAuth2 (Hybrid) â”‚    â”‚  â””â”€â”€ SSE Streaming   â”‚           â”‚
â”‚  â”‚  â””â”€â”€ Transaction     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATA LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PostgreSQL 16   â”‚  â”‚  Redis 7         â”‚  â”‚  Finnhub API   â”‚ â”‚
â”‚  â”‚  (Main DB)       â”‚  â”‚  (Cache/Pub-Sub) â”‚  â”‚  (Market Data) â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Users       â”‚  â”‚  â”œâ”€â”€ Session     â”‚  â”‚  â”œâ”€â”€ WebSocket â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Wallet      â”‚  â”‚  â”œâ”€â”€ Portfolio   â”‚  â”‚  â””â”€â”€ REST API  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Trade Logs  â”‚  â”‚  â”œâ”€â”€ Ranking     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚  â”œâ”€â”€ Chat Historyâ”‚  â”‚  â””â”€â”€ Pub/Sub     â”‚                     â”‚
â”‚  â”‚  â”œâ”€â”€ Items       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **WebSocket (STOMP) Endpoint**: `/ws-stomp`
- **Oracle SSE Endpoint**: `POST /api/v1/chat/ask` (ë°±ì—”ë“œ í”„ë¡ì‹œ)

---

## 3. ê¸°ìˆ  ìŠ¤íƒ

### 3.1 Frontend

| ê¸°ìˆ                | ë²„ì „  | ìš©ë„                             |
| ------------------ | ----- | -------------------------------- |
| Next.js            | 16.x  | React í”„ë ˆì„ì›Œí¬ (App Router)    |
| React              | 19.x  | UI ë¼ì´ë¸ŒëŸ¬ë¦¬                    |
| TypeScript         | 5.x   | íƒ€ì… ì•ˆì „ì„±                      |
| Tailwind CSS       | 3.4.x | ìŠ¤íƒ€ì¼ë§                         |
| Zustand            | 5.x   | ì „ì—­ ìƒíƒœ ê´€ë¦¬                   |
| @stomp/stompjs     | 7.x   | WebSocket í´ë¼ì´ì–¸íŠ¸             |
| lightweight-charts | 5.x   | ìº”ë“¤ ì°¨íŠ¸                        |
| Axios              | 1.x   | HTTP í´ë¼ì´ì–¸íŠ¸                  |
| next-auth          | 5.x   | ì¸ì¦ (Credentials/OAuth Wrapper) |

### 3.2 Backend (Core)

| ê¸°ìˆ              | ë²„ì „   | ìš©ë„                      |
| ---------------- | ------ | ------------------------- |
| Java             | 21 LTS | ì–¸ì–´                      |
| Spring Boot      | 3.4.x  | í”„ë ˆì„ì›Œí¬                |
| Spring Security  | 6.x    | ì¸ì¦/ì¸ê°€ (OAuth2 Client) |
| Spring Data JPA  | 3.x    | ORM                       |
| Spring WebSocket | 6.x    | ì‹¤ì‹œê°„ í†µì‹  (STOMP)       |

### 3.3 Backend (AI)

| ê¸°ìˆ          | ë²„ì „   | ìš©ë„          |
| ------------ | ------ | ------------- |
| Python       | 3.11+  | ì–¸ì–´          |
| FastAPI      | 0.100+ | API ì„œë²„      |
| PyTorch      | 2.x    | AI í”„ë ˆì„ì›Œí¬ |
| Transformers | Latest | LLM           |

---

## 4. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 4.1 ERD ìš”ì•½

```mermaid
erDiagram
    Users ||--|| Wallet : has
    Users ||--o{ Portfolio : owns
    Users ||--o{ TradeLogs : executes
    Users ||--o{ Inventory : has
    Inventory }|--|| Items : contains
    Users ||--o{ ChatHistory : chats
    Users ||--o{ Watchlist : monitors
    Users ||--o{ Notifications : receives
```

### 4.2 í…Œì´ë¸” DDL

#### users (ì‚¬ìš©ì)

```sql
CREATE TABLE users (
    user_id BIGSERIAL PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255),             -- ì¼ë°˜ íšŒì›ìš© (BCrypt)
    nickname VARCHAR(50) NOT NULL,
    provider VARCHAR(20) DEFAULT 'LOCAL', -- LOCAL, GOOGLE, KAKAO
    birth_date DATE,                   -- ì˜¨ë³´ë”© ì…ë ¥ (ì–‘ë ¥/ìŒë ¥)
    birth_time TIME,                   -- ğŸ†• ìƒë…„ì›”ì¼ì‹œ (ê¸°ë³¸ê°’ 00:00:00)
    gender VARCHAR(10),                -- ğŸ†• ì„±ë³„ (MALE/FEMALE/OTHER)
    calendar_type VARCHAR(20),         -- ğŸ†• ì–‘ë ¥/ìŒë ¥ êµ¬ë¶„ (SOLAR/LUNAR/LUNAR_LEAP)
    saju_element VARCHAR(10),          -- FIRE, WATER, WOOD, GOLD, EARTH
    zodiac_sign VARCHAR(20),           -- ë 
    avatar_url TEXT,
    is_public BOOLEAN DEFAULT TRUE,    -- ğŸ†• í”„ë¡œí•„ ê³µê°œ ì—¬ë¶€
    is_ranking_joined BOOLEAN DEFAULT TRUE, -- ğŸ†• ë­í‚¹ ì°¸ì—¬ ì—¬ë¶€
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### items (ì•„ì´í…œ ë§ˆìŠ¤í„°)

```sql
CREATE TABLE items (
    item_id BIGSERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    category VARCHAR(20) NOT NULL,        -- ğŸ†• NAMEPLATE, AVATAR, THEME
    rarity VARCHAR(20) NOT NULL,          -- COMMON, RARE, EPIC, LEGENDARY
    probability FLOAT NOT NULL,           -- í™•ë¥  (0.0~1.0)
    image_url TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

##### `items.category` ë ˆê±°ì‹œâ†’ëª©í‘œ ë§¤í•‘ ì •ì±… (Phase 1 ê³ ì •)

Flyway V3ì—ì„œ ì•„ë˜ ë§¤í•‘ìœ¼ë¡œ **ê¸°ì¡´ ë°ì´í„°(category ë¬¸ìì—´)**ë¥¼ ëª©í‘œ ì²´ê³„ë¡œ ì „í™˜í•©ë‹ˆë‹¤.

| Legacy Category (V1) | Target Category (Phase 1+) | ë¹„ê³                          |
| -------------------- | -------------------------- | ---------------------------- |
| `COSTUME`            | `AVATAR`                   | ì•„ë°”íƒ€ ê¾¸ë¯¸ê¸° ì•„ì´í…œ(ë ˆê±°ì‹œ) |
| `ACCESSORY`          | `AVATAR`                   | ì•„ë°”íƒ€ ê¾¸ë¯¸ê¸° ì•„ì´í…œ(ë ˆê±°ì‹œ) |
| `AURA`               | `AVATAR`                   | ì•„ë°”íƒ€ ê¾¸ë¯¸ê¸° ì•„ì´í…œ(ë ˆê±°ì‹œ) |
| `BACKGROUND`         | `THEME`                    | í™”ë©´/ë°°ê²½ ê³„ì—´(ë ˆê±°ì‹œ)       |

##### Unknown ì²˜ë¦¬ ì •ì±… (Fail Fast, Phase 1 ê³ ì •)

- Flyway V3ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„ `items.category`ì— `NAMEPLATE | AVATAR | THEME` ì™¸ ê°’ì´ ë‚¨ì•„ìˆìœ¼ë©´ **ì¦‰ì‹œ ì‹¤íŒ¨(raise)**í•´ì•¼ í•©ë‹ˆë‹¤.
- (ê¶Œì¥) DB ì œì•½(`CHECK`)ì„ ì¶”ê°€í•´ ì´í›„ ì˜ëª»ëœ ê°’ì´ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ ì›ì²œ ì°¨ë‹¨í•©ë‹ˆë‹¤.

_(ë‚˜ë¨¸ì§€ í…Œì´ë¸” `wallet`, `portfolio`, `trade_logs`, `inventory`, `watchlist`, `chat_history`, `notifications`ëŠ” Ver 2.4ì™€ ë™ì¼)_

---

## 5. API ëª…ì„¸

### 5.0 ê³µí†µ ì‘ë‹µ ê·œì•½ (Phase 0: Interface Freeze)

ë³¸ í”„ë¡œì íŠ¸ëŠ” **ì „ì—­ `ApiResponse{ success, data }` ë˜í¼ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ **, ì—”ë“œí¬ì¸íŠ¸ë³„ Response DTOë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤. (Springì—ì„œ í”íˆ ì“°ì´ëŠ” â€œDTO Direct Responseâ€ ë°©ì‹)

#### 5.0.1 ì„±ê³µ ì‘ë‹µ (2xx)

- **Content-Type**: `application/json; charset=utf-8`
- **Body**: ì•„ë˜ 5.0.3ì˜ â€œìµœì†Œ í•„ë“œ ìŠ¤í‚¤ë§ˆâ€ë¥¼ ë”°ë¥´ëŠ” JSON
- **ë¦¬ìŠ¤íŠ¸ ì‘ë‹µ í‘œì¤€(í™•ì¥ì„± ëª©ì )**: ë¦¬ìŠ¤íŠ¸ëŠ” ë°°ì—´ì„ ë°”ë¡œ ë‚´ë¦¬ì§€ ì•Šê³  ì•„ë˜ì²˜ëŸ¼ ê°ìŒ‰ë‹ˆë‹¤.

```json
{
  "items": []
}
```

> ì´ìœ : ì¶”í›„ `asOf`, `nextCursor`, `totalCount` ë“± ë©”íƒ€ë°ì´í„°ë¥¼ ì¶”ê°€í•  ë•Œ í”„ë¡ íŠ¸/ë°±ì—”ë“œ ë³€ê²½ ë²”ìœ„ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

#### 5.0.2 ì—ëŸ¬ ì‘ë‹µ (4xx/5xx)

ì—ëŸ¬ëŠ” `ErrorResponse` DTOë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```json
{
  "timestamp": "2026-01-18T12:00:00",
  "status": 400,
  "error": "TRADE_001",
  "message": "ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."
}
```

#### 5.0.3 íƒ€ì…/ë‹¨ìœ„ ê·œì•½

- **ì‹œê°„ ë¬¸ìì—´**: ISO-8601 ë¬¸ìì—´ (ì˜ˆ: `"2026-01-18T12:00:00"`). _(í˜„ì¬ ì„œë²„ êµ¬í˜„ì€ timezone offsetì„ í¬í•¨í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ)_
- **í¼ì„¼íŠ¸**: `changePercent`, `pnlPercent`ëŠ” **\(-100 ~ 100\)** ë²”ìœ„ì˜ â€œ% ê°’â€ì„ ì‚¬ìš© (ì˜ˆ: 1.23 = 1.23%)
- **í†µí™”**: `currency`ëŠ” ISO-4217 ì½”ë“œ(ì˜ˆ: `"USD"`, `"KRW"`)
- **ìˆ˜ì¹˜**: ê¸ˆì•¡/ê°€ê²©/í‰ê°€ê¸ˆì•¡ì€ `number`ë¡œ ë‚´ë ¤ì£¼ê³ , í‘œì‹œëŠ” í”„ë¡ íŠ¸ì—ì„œ í¬ë§¤íŒ…

### 5.0.4 Phase 0: ìµœì†Œ ì‘ë‹µ DTO ìŠ¤í‚¤ë§ˆ(í”„ë¡ íŠ¸ ì—°ë™ ì„ í–‰)

ì•„ë˜ ìŠ¤í‚¤ë§ˆëŠ” **í”„ë¡ íŠ¸ í˜ì´ì§€(ì‹œì¥/í¬íŠ¸í´ë¦¬ì˜¤/ìƒì /ë§ˆì´í˜ì´ì§€/ë­í‚¹)**ê°€ ì‹¤ë°ì´í„°ë¡œ ì „í™˜í•˜ê¸° ìœ„í•´ í•„ìš”í•œ â€œìµœì†Œ í•„ë“œâ€ë§Œ ìš°ì„  ê³ ì •í•©ë‹ˆë‹¤.

#### A) Market: Indices (`GET /api/v1/market/indices`)

```json
{
  "asOf": "2026-01-18T12:00:00",
  "items": [
    {
      "code": "NASDAQ",
      "name": "NASDAQ",
      "value": 15000.12,
      "change": 123.45,
      "changePercent": 0.83,
      "currency": "USD"
    },
    {
      "code": "SP500",
      "name": "SP500",
      "value": 4800.56,
      "change": -12.34,
      "changePercent": -0.26,
      "currency": "USD"
    },
    {
      "code": "DJI",
      "name": "DJI",
      "value": 38500.78,
      "change": 234.56,
      "changePercent": 0.61,
      "currency": "USD"
    }
  ]
}
```

- `code`: í”„ë¡ íŠ¸ í‘œì‹œ/ë§µí•‘ í‚¤ (ì˜ˆ: NASDAQ, SP500, DJI)
- `value/change/changePercent`: ì¹´ë“œ/ì°¨íŠ¸ ìš”ì•½ì— ì‚¬ìš©
- **ì°¸ê³ **: Finnhub Quote APIëŠ” ì§€ìˆ˜ ì‹¬ë³¼(`^DJI`, `^GSPC`, `^IXIC`)ì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í•´ë‹¹ ì§€ìˆ˜ë¥¼ ì¶”ì í•˜ëŠ” ETFë¥¼ ì‚¬ìš© (SPY=S&P 500, QQQ=NASDAQ-100, DIA=Dow Jones)

#### B) Market: News (`GET /api/v1/market/news`)

```json
{
  "asOf": "2026-01-18T12:00:00",
  "items": [
    {
      "id": "finnhub:123456",
      "headline": "Market headline",
      "summary": "Short summary",
      "source": "Reuters",
      "url": "https://example.com/news/123456",
      "imageUrl": "https://example.com/image.jpg",
      "publishedAt": "2026-01-18T11:50:00"
    }
  ]
}
```

#### C) Market: Movers (`GET /api/v1/market/movers`)

```json
{
  "asOf": "2026-01-18T12:00:00",
  "items": [
    {
      "ticker": "AAPL",
      "name": "Apple Inc.",
      "price": 195.12,
      "changePercent": -1.23,
      "volume": 12345678,
      "direction": "DOWN"
    }
  ]
}
```

- `direction`: `"UP" | "DOWN"` (UI ë°°ì§€/ìƒ‰ìƒ)

#### D) Portfolio (`GET /api/v1/trade/portfolio`)

```json
{
  "asOf": "2026-01-18T12:00:00",
  "summary": {
    "totalEquity": 10500.0,
    "cashBalance": 2500.0,
    "totalPnl": 500.0,
    "totalPnlPercent": 5.0,
    "currency": "USD"
  },
  "positions": [
    {
      "ticker": "AAPL",
      "quantity": 10,
      "avgPrice": 180.0,
      "currentPrice": 195.12,
      "marketValue": 1951.2,
      "pnl": 151.2,
      "pnlPercent": 8.4
    }
  ]
}
```

#### E) Inventory (`GET /api/v1/game/inventory`)

```json
{
  "items": [
    {
      "itemId": 1,
      "name": "Golden Frame",
      "category": "NAMEPLATE",
      "rarity": "EPIC",
      "imageUrl": "https://example.com/item.png",
      "equipped": true
    }
  ]
}
```

#### F) Ranking (`GET /api/v1/game/ranking`)

```json
{
  "asOf": "2026-01-18T12:00:00",
  "items": [
    {
      "rank": 1,
      "userId": 10,
      "nickname": "pjjpj",
      "avatarUrl": "https://example.com/avatar.png",
      "totalEquity": 10500.0,
      "returnPercent": 5.0
    }
  ],
  "my": {
    "rank": 12,
    "totalEquity": 9800.0,
    "returnPercent": -2.0
  }
}
```

> ë­í‚¹ ê³„ì‚°/ì •ë ¬ ê¸°ì¤€(ì˜ˆ: `returnPercent` vs `totalEquity`)ì€ Phase 5ì—ì„œ í™•ì • êµ¬í˜„í•˜ë˜, **í”„ë¡ íŠ¸ í‘œì‹œ ìµœì†Œ í•„ë“œ**ëŠ” Phase 0ì—ì„œ ê³ ì •í•©ë‹ˆë‹¤.

### 5.1 ì¸ì¦ API (`/api/v1/auth`)

| Method | Endpoint        | ì„¤ëª…                                                 |
| ------ | --------------- | ---------------------------------------------------- |
| POST   | `/signup`       | ì¼ë°˜ íšŒì›ê°€ì…                                        |
| POST   | `/login`        | ì¼ë°˜ ë¡œê·¸ì¸                                          |
| POST   | `/logout`       | ë¡œê·¸ì•„ì›ƒ                                             |
| POST   | `/refresh`      | í† í° ê°±ì‹                                             |
| GET    | `/me`           | í˜„ì¬ ì‚¬ìš©ì ì •ë³´ (ë³´ì•ˆ)                              |
| POST   | `/oauth/kakao`  | **Frontend-Driven** Kakao ë¡œê·¸ì¸ (Body: accessToken) |
| POST   | `/oauth/google` | **Frontend-Driven** Google ë¡œê·¸ì¸ (Body: idToken)    |

### 5.2 ì‚¬ìš©ì API (`/api/v1/user`)

| Method | Endpoint           | ì„¤ëª…                                                            |
| ------ | ------------------ | --------------------------------------------------------------- |
| GET    | `/me`              | ë‚´ í”„ë¡œí•„ ìƒì„¸ ì¡°íšŒ (`UserMeResponse`, email í¬í•¨)              |
| PUT    | `/me`              | í”„ë¡œí•„/ì„¤ì • ìˆ˜ì • (ë‹‰ë„¤ì„, ê³µê°œì—¬ë¶€ ë“±)                          |
| POST   | `/onboarding`      | ì˜¨ë³´ë”© (ì •ë°€ ì‚¬ì£¼ ê³„ì‚°: 4ì£¼ ì™„ì „ êµ¬í˜„, í•œêµ­ì²œë¬¸ì—°êµ¬ì› API ì—°ë™) |
| GET    | `/wallet`          | ì§€ê°‘ ì •ë³´ (ì˜ˆìˆ˜ê¸ˆ, ì½”ì¸ ë“±)                                     |
| GET    | `/watchlist`       | ë‚´ ê´€ì‹¬ì¢…ëª© ì¡°íšŒ (`UserWatchlistResponse`)                      |
| POST   | `/watchlist`       | ê´€ì‹¬ì¢…ëª© ì¶”ê°€ (Request: `{ ticker: string }`)                   |
| DELETE | `/watchlist/{ticker}` | ê´€ì‹¬ì¢…ëª© ì‚­ì œ                                                |
| GET    | `/{userId}`        | íƒ€ì¸ í”„ë¡œí•„ ê³µê°œ ì¡°íšŒ (í–¥í›„, `UserPublicResponse`, email ì œì™¸)  |

#### 5.2.1 Watchlist API

**GET /api/v1/user/watchlist**
- Response: `{ items: [{ ticker, addedAt }] }`
- ì¸ì¦: JWT í•„ìš”

**POST /api/v1/user/watchlist**
- Request: `{ ticker: string }`
- Response: `UserWatchlistResponse` (ì „ì²´ ëª©ë¡)
- ì¤‘ë³µ ì‹œ idempotentí•˜ê²Œ ë¬´ì‹œ

**DELETE /api/v1/user/watchlist/{ticker}**
- Path Variable: `ticker`
- Response: `UserWatchlistResponse` ë˜ëŠ” 204 No Content

### 5.3 ì‹œì¥/ì£¼ì‹ API (`/api/v1/market`, `/api/v1/stock`) ğŸ†•

| Method | Endpoint                  | ì„¤ëª…                                   |
| ------ | ------------------------- | -------------------------------------- |
| GET    | `/market/indices`         | ì£¼ìš” ì‹œì¥ ì§€ìˆ˜ ì¡°íšŒ (ETF ì‚¬ìš©: SPY, QQQ, DIA) |
| GET    | `/market/news`            | ìµœì‹  ì‹œì¥ ë‰´ìŠ¤ ì¡°íšŒ                    |
| GET    | `/market/movers`          | ê¸‰ë“±/ê¸‰ë½/ê±°ë˜ëŸ‰ ìƒìœ„ ì¢…ëª© ì¡°íšŒ        |
| GET    | `/stock/search`           | ì¢…ëª© ê²€ìƒ‰ (Query: keyword)             |
| GET    | `/stock/quote/{ticker}`   | íŠ¹ì • ì¢…ëª© í˜„ì¬ê°€/í˜¸ê°€ ì¡°íšŒ             |
| GET    | `/stock/candles/{ticker}` | ìº”ë“¤ ì°¨íŠ¸ ë°ì´í„° ì¡°íšŒ (EODHD + DB ìºì‹±) |

#### 5.3.1 Historical Data (Candles) API ë™ì‘ ë°©ì‹

**ë°ì´í„° ì „ëµ**: EODHD API + DB ìºì‹± ê¸°ë°˜ (`docs/DATA_STRATEGY_PLAN.md` ì°¸ì¡°)

**ë™ì‘ íë¦„**:
1. **DB ì¡°íšŒ ìš°ì„ **: `stock_candles` í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ì¢…ëª© ë°ì´í„° ì¡°íšŒ
2. **ìµœì‹ ì„± ì²´í¬**: ì˜¤ëŠ˜ ì¥ ì¢…ë£Œ í›„ ì˜¤ëŠ˜ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
3. **Quota ì²´í¬**: `api_usage_logs` í…Œì´ë¸”ì—ì„œ ì˜¤ëŠ˜ EODHD í˜¸ì¶œ íšŸìˆ˜ í™•ì¸ (ì¼ì¼ 20íšŒ ì œí•œ)
4. **ë¶„ê¸° ì²˜ë¦¬**:
   - **ë°ì´í„° ìµœì‹ **: DB ë°ì´í„° ë°˜í™˜ (API í˜¸ì¶œ ì—†ìŒ)
   - **ë°ì´í„° êµ¬ì‹ + Quota ì—¬ìœ **: EODHD í˜¸ì¶œ â†’ DB ì €ì¥ â†’ ë°ì´í„° ë°˜í™˜
   - **Quota ì´ˆê³¼ + ê¸°ì¡´ ë°ì´í„° ìˆìŒ**: DB ë°ì´í„° ë°˜í™˜ + `X-Data-Status: Stale` í—¤ë” ë˜ëŠ” `warning` í•„ë“œ í¬í•¨
   - **Quota ì´ˆê³¼ + ê¸°ì¡´ ë°ì´í„° ì—†ìŒ**: `429 Too Many Requests` ì—ëŸ¬ ë°˜í™˜

**âš ï¸ ì£¼ì˜ì‚¬í•­**:
- **ë¬´ë£Œ êµ¬ë… ì œí•œ**: EODHD ë¬´ë£Œ í”Œëœì€ **ìµœê·¼ 1ë…„ ë°ì´í„°ë§Œ ì œê³µ**í•©ë‹ˆë‹¤.
  - 1ë…„ ì´ì „ ë‚ ì§œ ë²”ìœ„ ìš”ì²­ ì‹œ `{"warning":"Data is limited by one year as you have free subscription"}` ê²½ê³  ë©”ì‹œì§€ê°€ ë°˜í™˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ì‹¤ì œ ìº”ë“¤ ë°ì´í„° ì—†ì´ ê²½ê³ ë§Œ ë°˜í™˜ë˜ëŠ” ê²½ìš°, ì‘ë‹µì—ì„œ `warning` í•„ë“œë¥¼ ì²´í¬í•˜ì—¬ í•„í„°ë§í•´ì•¼ í•©ë‹ˆë‹¤.
- **í‹°ì»¤ í˜•ì‹**: EODHD APIëŠ” `{SYMBOL}.{EXCHANGE_ID}` í˜•ì‹ì„ ê¶Œì¥í•©ë‹ˆë‹¤ (ì˜ˆ: `AAPL.US`). ê±°ë˜ì†Œ ì½”ë“œê°€ ì—†ìœ¼ë©´ ë°±ì—”ë“œì—ì„œ ìë™ìœ¼ë¡œ `.US`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

**ì´ˆê¸° êµ¬ì¶• ì „ëµ (Seed Data)**:
- ì„œë²„ ì‹œì‘ ì‹œì ì´ ì•„ë‹ˆë¼, **"ìµœì´ˆ ìš”ì²­ ì‹œ"** ë˜ëŠ” **"ê´€ë¦¬ì íŠ¸ë¦¬ê±°"**ë¡œ ì¸ê¸° ì¢…ëª©(Top 10)ë§Œ ìš°ì„  ì ì¬
- ë¹„ì¸ê¸° ì¢…ëª©ì€ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ì¿¼í„°ê°€ ë‚¨ìœ¼ë©´ ì ì¬

**ì—ëŸ¬ ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "timestamp": "2026-01-19T12:00:00",
  "status": 429,
  "error": "QUOTA_EXCEEDED",
  "message": "ì¼ì¼ ì™¸ë¶€ ë°ì´í„° ìš”ì²­ í—ˆìš©ëŸ‰ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (ë§¤ì¼ 00:00 ì´ˆê¸°í™”)"
}
```

### 5.4 ê±°ë˜ API (`/api/v1/trade`)

| Method | Endpoint             | ì„¤ëª…                     |
| ------ | -------------------- | ------------------------ |
| GET    | `/api/v1/trade/available-balance` | ë§¤ìˆ˜ ê°€ëŠ¥ ê¸ˆì•¡ ì¡°íšŒ      |
| POST   | `/api/v1/trade/order`             | ë§¤ìˆ˜/ë§¤ë„ ì£¼ë¬¸ ì‹¤í–‰      |
| GET    | `/api/v1/trade/portfolio`         | ë³´ìœ  ì¢…ëª© ë° ìˆ˜ìµë¥  ì¡°íšŒ |
| GET    | `/api/v1/trade/history`           | ê±°ë˜ ë‚´ì—­ ì¡°íšŒ           |

#### 5.4.1 ê±°ë˜ ì‹¤í–‰ íë¦„

ê±°ë˜ ì£¼ë¬¸ì€ ë¹„ê´€ì  ë½(Pessimistic Lock)ì„ ì‚¬ìš©í•˜ì—¬ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

**ë§¤ìˆ˜ ì£¼ë¬¸ íë¦„**:

```mermaid
sequenceDiagram
    participant C as Controller
    participant TS as TradeService
    participant WR as WalletRepository
    participant PR as PortfolioRepository
    participant SSR as StockService
    participant TLR as TradeLogRepository
    
    C->>TS: executeOrder(userId, request)
    activate TS
    
    TS->>SSR: getQuote(ticker)
    Note over TS,SSR: íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ í˜¸ì¶œ
    SSR-->>TS: currentPrice
    
    TS->>TS: executeOrderInTransaction()
    Note over TS: @Transactional ì‹œì‘
    
    TS->>WR: findByUserIdWithLock(userId)
    WR-->>TS: Wallet (ë½ íšë“)
    
    TS->>TS: ì”ê³  í™•ì¸
    alt ì”ê³  ë¶€ì¡±
        TS-->>C: TradeException(INSUFFICIENT_BALANCE)
    end
    
    TS->>PR: findByUserIdAndTickerWithLock(userId, ticker)
    PR-->>TS: Portfolio or Empty (ë½ íšë“)
    
    TS->>TS: Wallet.deductCash()
    TS->>TS: Portfolio.addQuantity() or ìƒì„±
    
    TS->>TLR: save(TradeLog)
    TS->>WR: save(Wallet)
    TS->>PR: save(Portfolio)
    
    Note over TS: íŠ¸ëœì­ì…˜ ì»¤ë°‹ (ë½ í•´ì œ)
    TS-->>C: TradeResponse
    deactivate TS
```

**ë§¤ë„ ì£¼ë¬¸ íë¦„**:

```mermaid
sequenceDiagram
    participant C as Controller
    participant TS as TradeService
    participant WR as WalletRepository
    participant PR as PortfolioRepository
    participant SSR as StockService
    participant TLR as TradeLogRepository
    
    C->>TS: executeOrder(userId, request)
    activate TS
    
    TS->>SSR: getQuote(ticker)
    Note over TS,SSR: íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ í˜¸ì¶œ
    SSR-->>TS: currentPrice
    
    TS->>TS: executeOrderInTransaction()
    Note over TS: @Transactional ì‹œì‘
    
    TS->>WR: findByUserIdWithLock(userId)
    WR-->>TS: Wallet (ë½ íšë“)
    
    TS->>TS: executeSellOrder í˜¸ì¶œ
    
    TS->>PR: findByUserIdAndTickerWithLock(userId, ticker)
    PR-->>TS: Portfolio (ë½ íšë“)
    
    alt ë³´ìœ  ìˆ˜ëŸ‰ ì—†ìŒ
        TS-->>C: TradeException(INSUFFICIENT_QUANTITY)
    end
    
    TS->>TS: ë³´ìœ  ìˆ˜ëŸ‰ í™•ì¸
    alt ìˆ˜ëŸ‰ ë¶€ì¡±
        TS-->>C: TradeException(INSUFFICIENT_QUANTITY)
    end
    
    TS->>TS: ì‹¤í˜„ ì†ìµ ê³„ì‚°
    TS->>TS: Portfolio.subtractQuantity()
    
    TS->>TS: Wallet.addCash()
    TS->>TS: Wallet.addRealizedProfit()
    
    alt Portfolio.isEmpty()
        TS->>PR: delete(Portfolio)
    end
    
    TS->>TLR: save(TradeLog with realizedPnl)
    TS->>WR: save(Wallet)
    TS->>PR: save(Portfolio) or delete
    
    Note over TS: íŠ¸ëœì­ì…˜ ì»¤ë°‹ (ë½ í•´ì œ)
    TS-->>C: TradeResponse
    deactivate TS
```

#### 5.4.2 ë™ì‹œì„± ì œì–´

**ë™ì‹œì„± ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤**:

1. **ì‹œë‚˜ë¦¬ì˜¤ 1: ë™ì‹œ ë§¤ìˆ˜ ì£¼ë¬¸**
   - ì‚¬ìš©ì Aê°€ ë™ì‹œì— 2ê°œì˜ ë§¤ìˆ˜ ì£¼ë¬¸ì„ ë³´ëƒ„
   - ì”ê³ ê°€ 1ê°œ ì£¼ë¬¸ë§Œ ê°€ëŠ¥í•œ ê²½ìš°
   - **ë¬¸ì œ**: ë‘ ì£¼ë¬¸ ëª¨ë‘ ì”ê³  í™•ì¸ í†µê³¼ í›„ ì‹¤í–‰ë˜ì–´ ì”ê³  ì´ˆê³¼
   - **í•´ê²°**: ë¹„ê´€ì  ë½ìœ¼ë¡œ Wallet ì¡°íšŒ ì‹œ ë½ íšë“, í•œ ë²ˆì— í•˜ë‚˜ì˜ ê±°ë˜ë§Œ ì‹¤í–‰

2. **ì‹œë‚˜ë¦¬ì˜¤ 2: ë™ì‹œ ë§¤ë„ ì£¼ë¬¸**
   - ì‚¬ìš©ì Aê°€ ë™ì‹œì— 2ê°œì˜ ë§¤ë„ ì£¼ë¬¸ì„ ë³´ëƒ„
   - ë³´ìœ  ìˆ˜ëŸ‰ì´ 1ê°œ ì£¼ë¬¸ë§Œ ê°€ëŠ¥í•œ ê²½ìš°
   - **ë¬¸ì œ**: ë‘ ì£¼ë¬¸ ëª¨ë‘ ìˆ˜ëŸ‰ í™•ì¸ í†µê³¼ í›„ ì‹¤í–‰ë˜ì–´ ìˆ˜ëŸ‰ ì´ˆê³¼
   - **í•´ê²°**: ë¹„ê´€ì  ë½ìœ¼ë¡œ Portfolio ì¡°íšŒ ì‹œ ë½ íšë“, í•œ ë²ˆì— í•˜ë‚˜ì˜ ê±°ë˜ë§Œ ì‹¤í–‰

3. **ì‹œë‚˜ë¦¬ì˜¤ 3: ë§¤ìˆ˜/ë§¤ë„ ë™ì‹œ ì‹¤í–‰**
   - ì‚¬ìš©ì Aê°€ ë§¤ìˆ˜ ì£¼ë¬¸ê³¼ ë§¤ë„ ì£¼ë¬¸ì„ ë™ì‹œì— ë³´ëƒ„
   - **ë¬¸ì œ**: í¬íŠ¸í´ë¦¬ì˜¤ ì—…ë°ì´íŠ¸ ì‹œ ê²½ìŸ ì¡°ê±´ ë°œìƒ
   - **í•´ê²°**: ë¹„ê´€ì  ë½ìœ¼ë¡œ Portfolioì™€ Wallet ëª¨ë‘ ë½ íšë“, ìˆœì°¨ ì‹¤í–‰

**ë½ ì „ëµ**:

- **ë¹„ê´€ì  ë½ (Pessimistic Lock) ì‚¬ìš©**
  - `WalletRepository.findByUserIdWithLock()`: Wallet ì¡°íšŒ ì‹œ ë½ íšë“
  - `PortfolioRepository.findByUserIdAndTickerWithLock()`: Portfolio ì¡°íšŒ ì‹œ ë½ íšë“
  - ë½ ë²”ìœ„: íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ë¶€í„° ì»¤ë°‹ê¹Œì§€ ìœ ì§€

- **íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€**
  - ê¸°ë³¸ê°’: `READ_COMMITTED` (PostgreSQL ê¸°ë³¸ê°’)
  - ë½ íƒ€ì„ì•„ì›ƒ: 5ì´ˆ (ê¸°ë³¸ê°’, í•„ìš” ì‹œ ì¡°ì •)

- **íŠ¸ëœì­ì…˜ ë²”ìœ„**
  - `@Transactional` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì „ì²´ ê±°ë˜ë¥¼ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬
  - âœ… **ì™¸ë¶€ API í˜¸ì¶œ(`StockService.getQuote()`)ì€ íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ í˜¸ì¶œë¨**
    - `executeOrder()`: ì™¸ë¶€ API í˜¸ì¶œ (íŠ¸ëœì­ì…˜ ì—†ìŒ)
    - `executeOrderInTransaction()`: ì‹¤ì œ ê±°ë˜ ë¡œì§ (íŠ¸ëœì­ì…˜ ë‚´ë¶€)
    - ì™¸ë¶€ API ì§€ì—° ì‹œì—ë„ íŠ¸ëœì­ì…˜ ìœ ì§€ ì‹œê°„ì„ ìµœì†Œí™”í•˜ì—¬ ì„±ëŠ¥ ê°œì„  ì™„ë£Œ
  - âœ… **Self-invocation ë¬¸ì œ í•´ê²°**: Spring AOP í”„ë¡ì‹œ ë™ì‘ì„ ìœ„í•´ ìê¸° ì£¼ì…(Self-injection) íŒ¨í„´ ì‚¬ìš©
    - `TradeService`ì— `@Autowired @Lazy private TradeService self` ì£¼ì…
    - `executeOrder()`ì—ì„œ `self.executeOrderInTransaction()` í˜¸ì¶œë¡œ í”„ë¡ì‹œë¥¼ ê²½ìœ í•˜ì—¬ íŠ¸ëœì­ì…˜ ì ìš©
    - `executeOrderInTransaction()`ì€ `public`ìœ¼ë¡œ ë³€ê²½ (í”„ë¡ì‹œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡)
    - ë³´ì•ˆ: Controllerì— ë§¤í•‘ë˜ì§€ ì•Šì•„ ì™¸ë¶€ HTTP ìš”ì²­ìœ¼ë¡œëŠ” ì ‘ê·¼ ë¶ˆê°€ëŠ¥

#### 5.4.3 Request/Response DTO ìƒì„¸

**TradeOrderRequest** (POST `/api/v1/trade/order`):

```json
{
  "ticker": "AAPL",
  "type": "BUY",
  "quantity": 10
}
```

- `ticker` (String, í•„ìˆ˜): ì¢…ëª© ì½”ë“œ (ì˜ˆ: "AAPL")
- `type` (String, í•„ìˆ˜): ê±°ë˜ íƒ€ì… ("BUY" ë˜ëŠ” "SELL")
- `quantity` (Integer, í•„ìˆ˜, ìµœì†Œê°’: 1): ì£¼ë¬¸ ìˆ˜ëŸ‰

**AvailableBalanceResponse** (GET `/api/v1/trade/available-balance`):

```json
{
  "availableBalance": 10000.0,
  "cashBalance": 10000.0,
  "currency": "USD"
}
```

**TradeResponse** (POST `/api/v1/trade/order`):

```json
{
  "orderId": 12345,
  "ticker": "AAPL",
  "type": "BUY",
  "quantity": 10,
  "executedPrice": 195.12,
  "totalAmount": 1951.2,
  "executedAt": "2026-01-19T12:00:00"
}
```

**TradeHistoryResponse** (GET `/api/v1/trade/history`):

```json
{
  "asOf": "2026-01-19T12:00:00",
  "items": [
    {
      "logId": 12345,
      "ticker": "AAPL",
      "type": "BUY",
      "quantity": 10,
      "price": 195.12,
      "totalAmount": 1951.2,
      "realizedPnl": null,
      "tradeDate": "2026-01-19T12:00:00"
    },
    {
      "logId": 12346,
      "ticker": "AAPL",
      "type": "SELL",
      "quantity": 5,
      "price": 200.00,
      "totalAmount": 1000.0,
      "realizedPnl": 24.4,
      "tradeDate": "2026-01-19T13:00:00"
    }
  ]
}
```

**PortfolioResponse** (GET `/api/v1/trade/portfolio`):

```json
{
  "asOf": "2026-01-19T12:00:00",
  "summary": {
    "totalEquity": 10500.0,
    "cashBalance": 2500.0,
    "totalPnl": 500.0,
    "totalPnlPercent": 5.0,
    "currency": "USD"
  },
  "positions": [
    {
      "ticker": "AAPL",
      "quantity": 10,
      "avgPrice": 180.0,
      "currentPrice": 195.12,
      "marketValue": 1951.2,
      "pnl": 151.2,
      "pnlPercent": 8.4
    }
  ]
}
```

#### 5.4.4 ì˜ˆì™¸ ì²˜ë¦¬

| ì—ëŸ¬ ì½”ë“œ | HTTP ìƒíƒœ | ì„¤ëª… | í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬ ê°€ì´ë“œ |
| --------- | --------- | ---- | ---------------------- |
| `TRADE_001` | 400 | ì”ê³  ë¶€ì¡± | "ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤" í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ |
| `TRADE_002` | 400 | ë³´ìœ  ìˆ˜ëŸ‰ ë¶€ì¡± | "ë³´ìœ  ìˆ˜ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤" í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ |
| `TRADE_003` | 400 | ê±°ë˜ ì‹œê°„ ì™¸ | ê±°ë˜ ë¶ˆê°€ ì•ˆë‚´ ëª¨ë‹¬ (í–¥í›„ êµ¬í˜„) |
| `TRADE_004` | 400 | ìœ íš¨í•˜ì§€ ì•Šì€ ì¢…ëª© | ì¢…ëª© ê²€ìƒ‰ìœ¼ë¡œ ìœ ë„ |

**ì—ëŸ¬ ì‘ë‹µ ì˜ˆì‹œ**:

```json
{
  "timestamp": "2026-01-19T12:00:00",
  "status": 400,
  "error": "TRADE_001",
  "message": "ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."
}
```

### 5.5 ìƒì /ê²Œì„ API (`/api/v1/game`) ğŸ†•

| Method | Endpoint          | ì„¤ëª…                               |
| ------ | ----------------- | ---------------------------------- |
| GET    | `/items`          | ìƒì  ì•„ì´í…œ ëª©ë¡ (Query: category) |
| POST   | `/gacha`          | ê°€ì±  ë½‘ê¸° ì‹¤í–‰ (ì½”ì¸ ì°¨ê°)         |
| GET    | `/inventory`      | ë‚´ ì¸ë²¤í† ë¦¬ ì¡°íšŒ                   |
| PUT    | `/equip/{itemId}` | ì•„ì´í…œ ì¥ì°©/í•´ì œ í† ê¸€              |
| GET    | `/ranking`        | ìœ ì € ë­í‚¹ ì¡°íšŒ                     |

#### 5.5.1 Items (`GET /api/v1/game/items`)
- Query: `category`(optional, NAMEPLATE|AVATAR|THEME)
- Response: `{ asOf, items: [{ itemId, name, category, rarity, probability, imageUrl, description }] }`

#### 5.5.2 Gacha (`POST /api/v1/game/gacha`)
- ë¹„ìš©: 100 ê²Œì„ ì½”ì¸ ì°¨ê° (`wallet.game_coin`)
- ë™ì‘: í™•ë¥  ê¸°ë°˜ ì¶”ì²¨ â†’ ì´ë¯¸ ë³´ìœ í•œ ì•„ì´í…œì´ë©´ ìµœëŒ€ 10íšŒ ì¬ì¶”ì²¨ â†’ ëª¨ë‘ ì¤‘ë³µì´ë©´ `GAME_002`
- Response: `{ itemId, name, category, rarity, imageUrl, remainingCoin }`
- ì—ëŸ¬:
  - `GAME_001` ì½”ì¸ ë¶€ì¡±
  - `GAME_003` ê°€ì±  ëŒ€ìƒ ì•„ì´í…œ ì—†ìŒ
  - `GAME_002` ì¬ì¶”ì²¨ ì‹¤íŒ¨(ëª¨ë‘ ì¤‘ë³µ)

#### 5.5.3 Inventory (`GET /api/v1/game/inventory`)
- Response ì˜ˆì‹œ ìƒë‹¨ E) ì°¸ê³  (`items` ë°°ì—´, equipped í¬í•¨)

#### 5.5.4 Equip Toggle (`PUT /api/v1/game/equip/{itemId}`)
- ì¹´í…Œê³ ë¦¬ë³„ ë‹¨ì¼ ì¥ì°© ë³´ì¥: ê°™ì€ ì¹´í…Œê³ ë¦¬ì— ë‹¤ë¥¸ ì•„ì´í…œì´ ì¥ì°©ë˜ì–´ ìˆìœ¼ë©´ ìë™ í•´ì œ í›„ í† ê¸€
- Response: ì¸ë²¤í† ë¦¬ ì „ì²´(ë™ì¼ ìŠ¤í‚¤ë§ˆ)
- ì—ëŸ¬: `GAME_003` ì•„ì´í…œ ë¯¸ë³´ìœ 

#### 5.5.5 Ranking (`GET /api/v1/game/ranking`)
- ëŒ€ìƒ: `is_ranking_joined = true` ì‚¬ìš©ì
- ì •ë ¬: ì´ìì‚°(`wallet.total_assets`) ë‚´ë¦¼ì°¨ìˆœ, ìµœëŒ€ 50ëª…
- ìˆ˜ìµë¥  ê³„ì‚°: `(totalAssets - 10000) / 10000 * 100`
- Response ì˜ˆì‹œ ìƒë‹¨ F) ì°¸ê³  (`asOf`, `items`, `my`)

### 5.6 Phase 5.5: í”„ë¡ íŠ¸ ì—°ë™Â·DB ì œì•½ ë³´ê°• (Shop/Gacha/Inventory/Ranking)

- **í”„ë¡ íŠ¸ í˜„ì¬ ìƒíƒœ(Ver 2.7.11)**: `/shop`Â·`/gacha`Â·`/ranking`Â·`/mypage`ëŠ” ëª¨ì˜ë°ì´í„°/ìƒìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ë Œë”ë§ë˜ë©° Axios/STOMP/SSE ë¯¸ì—°ê²°.
- **ì‹¤ë°ì´í„° ì „í™˜ ì²´í¬ë¦¬ìŠ¤íŠ¸**:
  - `/api/v1/game/items` â†’ ìƒì /í™•ë¥  ì¹´ë“œ: `{ "items": [...] }` íŒ¨í„´, ì¹´í…Œê³ ë¦¬ `NAMEPLATE|AVATAR|THEME`ë§Œ í—ˆìš©
  - `/api/v1/game/gacha` â†’ ê°€ì±  ì‹¤í–‰: ì¤‘ë³µë§Œ ì¡´ì¬ ì‹œ `GAME_002` ì²˜ë¦¬, ì½”ì¸ ì°¨ê°/ê²°ê³¼ UI ë™ê¸°í™”
  - `/api/v1/game/inventory`, `/api/v1/game/equip/{itemId}` â†’ ì¸ë²¤í† ë¦¬ ì¡°íšŒÂ·ì¥ì°© ë‹¨ì¼ì„± ë°˜ì˜(ê¸°ì¡´ ì¥ì°© ìë™ í•´ì œ)
  - `/api/v1/game/ranking` â†’ ë­í‚¹/ì°¸ì—¬ í† ê¸€: `is_ranking_joined` í•„í„° ì ìš© ìƒíƒœ ìœ ì§€
- **DB/ì œì•½ ì¬í™•ì¸**:
  - `items.category`ëŠ” Flyway V3 ê¸°ì¤€ `NAMEPLATE/AVATAR/THEME` ì™¸ ê°’ ì¡´ì¬ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨(Fail Fast) + `CHECK` ì œì•½ ê¶Œì¥
  - ëª¨ë“  ë¦¬ìŠ¤íŠ¸ ì‘ë‹µì€ `{items:[...]}` íŒ¨í„´ ìœ ì§€, í•„ìš” ì‹œ `asOf` ë©”íƒ€ í¬í•¨
- **ì‹¤ì‹œê°„/ì§€í‘œ ì •í•©ì„±**:
  - STOMP ì—”ë“œí¬ì¸íŠ¸ `/ws-stomp` ê³ ì •
  - ì§€ìˆ˜ ë°ì´í„°ëŠ” ETF(SPY/QQQ/DIA) ì‚¬ìš© ë¬¸êµ¬ë¥¼ í”„ë¡ íŠ¸/ë°±ì—”ë“œ ë¬¸ì„œ ëª¨ë‘ ë™ì¼í•˜ê²Œ ìœ ì§€

---

## 6. í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

### 6.1 ë””ë ‰í† ë¦¬ êµ¬ì¡° (ëª©í‘œ êµ¬ì¡° / êµ¬í˜„ í˜„í™© í¬í•¨)

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (main)/                  # ë©”ì¸ ë ˆì´ì•„ì›ƒ (Sidebar + Chatbot)
â”‚   â”‚   â”œâ”€â”€ page.tsx             # ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â”œâ”€â”€ market/page.tsx      # ğŸ†• ì‹œì¥/ë‰´ìŠ¤
â”‚   â”‚   â”œâ”€â”€ trade/page.tsx       # ğŸ†• ê±°ë˜
â”‚   â”‚   â”œâ”€â”€ portfolio/page.tsx   # ğŸ†• í¬íŠ¸í´ë¦¬ì˜¤
â”‚   â”‚   â”œâ”€â”€ shop/page.tsx        # ğŸ†• ê°€ì±  ìƒµ
â”‚   â”‚   â”œâ”€â”€ ranking/page.tsx     # ë­í‚¹
â”‚   â”‚   â”œâ”€â”€ oracle/page.tsx      # AI ë„ì‚¬
â”‚   â”‚   â”œâ”€â”€ calculator/page.tsx  # ğŸ†• ê³„ì‚°ê¸° (êµ¬í˜„ ì˜ˆì •: Phase 1 ì •í•©ì„± ì‘ì—…)
â”‚   â”‚   â””â”€â”€ mypage/page.tsx      # ë§ˆì´í˜ì´ì§€
â”‚   â”œâ”€â”€ login/page.tsx           # ë¡œê·¸ì¸
â”‚   â”œâ”€â”€ onboarding/page.tsx      # ì˜¨ë³´ë”©
â”‚   â”œâ”€â”€ signup/page.tsx          # ğŸ†• íšŒì›ê°€ì… (êµ¬í˜„ ì˜ˆì •: Phase 1 ì •í•©ì„± ì‘ì—…)
â”‚   â”œâ”€â”€ oauth/callback/page.tsx  # ğŸ†• OAuth Callback (êµ¬í˜„ ì˜ˆì •: Phase 1 ì •í•©ì„± ì‘ì—…)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ dashboard/               # ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ (Chart, Order, Watchlist...)
â”‚   â”œâ”€â”€ layout/                  # Sidebar, Header, Chatbot
â”‚   â”œâ”€â”€ news/                    # Market ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ (í˜„ êµ¬í˜„: `news/`, ì •í•©ì„± ëª©í‘œ: `market/`ë¡œ ì •ë¦¬)
â”‚   â”œâ”€â”€ trade/                   # ğŸ†• Trade ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ gacha/                   # ğŸ†• Shop/Gacha ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ ...
â”œâ”€â”€ stores/                      # Zustand Stores
â”‚   â”œâ”€â”€ auth-store.ts
â”‚   â”œâ”€â”€ stock-store.ts
â”‚   â”œâ”€â”€ ui-store.ts
â”‚   â””â”€â”€ user-store.ts
â””â”€â”€ lib/
    â”œâ”€â”€ api/                     # API í´ë¼ì´ì–¸íŠ¸ ëª¨ë“ˆ
    â””â”€â”€ saju-calculator.ts       # ì‚¬ì£¼ ë¡œì§
```

### 6.2 ì£¼ìš” í˜ì´ì§€ ëª…ì„¸

1.  **ëŒ€ì‹œë³´ë“œ (`/`)**: ìœ„ì ¯ í˜•íƒœì˜ ìš”ì•½ ì •ë³´ (ìì‚° ì¶”ì´, ê´€ì‹¬ ì¢…ëª©, ê°„ë‹¨ ë­í‚¹).
2.  **ì‹œì¥ (`/market`)**: KOSPI/NASDAQ ë“± ì§€ìˆ˜, ê¸‰ë“±/ê¸‰ë½ ì¢…ëª©, ë‰´ìŠ¤ í”¼ë“œ.
3.  **ê±°ë˜ (`/trade`)**: ì‹¤ì‹œê°„ í˜¸ê°€ì°½, ì°¨íŠ¸, ë§¤ìˆ˜/ë§¤ë„ ì£¼ë¬¸ íŒ¨ë„.
4.  **í¬íŠ¸í´ë¦¬ì˜¤ (`/portfolio`)**: ë³´ìœ  ì¢…ëª© ìƒì„¸ ë¶„ì„, ë¹„ì¤‘ ì°¨íŠ¸, ê±°ë˜ ë‚´ì—­.
5.  **ìƒì  (`/shop`)**: ê°€ì±  ë¨¸ì‹  UI, ì•„ì´í…œ ë½‘ê¸°, íšë“ í™•ë¥  ì •ë³´.
6.  **AI ë„ì‚¬ (`/oracle`)**: LLM ê¸°ë°˜ íˆ¬ì ìƒë‹´ ì±„íŒ…, ì‚¬ì£¼/ìš´ì„¸ ì •ë³´.
7.  **ë§ˆì´í˜ì´ì§€ (`/mypage`)**: ì•„ë°”íƒ€ ê¾¸ë¯¸ê¸°, ì¸ë²¤í† ë¦¬ ê´€ë¦¬, ì‚¬ìš©ì ì„¤ì •.

---

## 7. ì¸ì¦ ë° ë³´ì•ˆ

### 7.1 ì¸ì¦ íë¦„ (Hybrid OAuth2)

MadCamp02ëŠ” ìœ ì—°í•œ ì—°ë™ì„ ìœ„í•´ ë‘ ê°€ì§€ ì¸ì¦ íë¦„ì„ ëª¨ë‘ ì œê³µí•©ë‹ˆë‹¤.

#### A. Backend-Driven (Web Standard)

1.  **ë¡œê·¸ì¸ ìš”ì²­**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `GET {BACKEND_URL}/oauth2/authorization/kakao`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸.
2.  **ì¸ì¦ ì²˜ë¦¬**: ë°±ì—”ë“œì—ì„œ ì†Œì…œ ì¸ì¦ í›„ JWT ìƒì„±.
3.  **í† í° ì „ë‹¬**: ë°±ì—”ë“œê°€ í”„ë¡ íŠ¸ì—”ë“œì˜ `/oauth/callback`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ë©° Query Parameterë¡œ í† í° ì „ë‹¬. _(í”„ë¡ íŠ¸ ë¼ìš°íŠ¸ êµ¬í˜„: Phase 1)_
    - ì˜ˆ: `http://localhost:3000/oauth/callback?accessToken=...&isNewUser=true`
4.  **ì„¸ì…˜ ì €ì¥**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í† í° ì¶”ì¶œ í›„ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ë° `auth-store` ì—…ë°ì´íŠ¸.

#### B. Frontend-Driven (Mobile/SPA)

1.  **í† í° íšë“**: í”„ë¡ íŠ¸ì—”ë“œ(ì•±)ì—ì„œ ì¹´ì¹´ì˜¤ SDK ë“±ì„ í†µí•´ Access Token ì§ì ‘ íšë“.
2.  **ë¡œê·¸ì¸ ìš”ì²­**: í”„ë¡ íŠ¸ì—”ë“œê°€ `POST /api/v1/auth/oauth/kakao` í˜¸ì¶œ (Body: `{ "accessToken": "..." }`).
3.  **í† í° ë°œê¸‰**: ë°±ì—”ë“œ ê²€ì¦ í›„ JWT ì‘ë‹µ.

---

## 10. ì‹¤ì‹œê°„ í†µì‹ 

### 10.1 WebSocket (STOMP) ê°œìš”

MadCamp02ëŠ” **Spring WebSocket (STOMP)**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ì£¼ê°€ ë°ì´í„°ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•©ë‹ˆë‹¤.

**ì•„í‚¤í…ì²˜ ì›ì¹™**:
- **ì„œë²„ ì¸¡**: Finnhub Trades WebSocketì„ **ë‹¨ì¼ ì—°ê²°(API í‚¤ë‹¹ 1ê°œ)**ë¡œ ìœ ì§€í•˜ê³ , ìˆ˜ì‹ í•œ trade ë©”ì‹œì§€ë¥¼ STOMPë¡œ ì¤‘ê³„
- **í´ë¼ì´ì–¸íŠ¸ ì¸¡**: í”„ë¡ íŠ¸ì—”ë“œëŠ” STOMPë§Œ ì‚¬ìš©í•˜ë©°, ì™¸ë¶€ WebSocket(Finnhub)ì— ì§ì ‘ ì—°ê²°í•˜ì§€ ì•ŠìŒ
- **ë³´ì•ˆ**: Finnhub API í‚¤ëŠ” ì„œë²„ì—ì„œë§Œ ì‚¬ìš©í•˜ë©°, í”„ë¡ íŠ¸ì—”ë“œë¡œ ë…¸ì¶œí•˜ì§€ ì•ŠìŒ

### 10.2 STOMP ì—”ë“œí¬ì¸íŠ¸ ë° í† í”½

#### ì—”ë“œí¬ì¸íŠ¸

- **WebSocket Endpoint**: `/ws-stomp`
- **í”„ë¡œí† ì½œ**: STOMP over WebSocket (SockJS fallback ì§€ì›)

#### êµ¬ë… ê°€ëŠ¥í•œ í† í”½

| í† í”½ íŒ¨í„´ | ì„¤ëª… | ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ |
|---------|------|-------------|
| `/topic/stock.indices` | ì‹œì¥ ì§€ìˆ˜ ì—…ë°ì´íŠ¸ (10ì´ˆ ì£¼ê¸°) | Market í˜ì´ì§€ |
| `/topic/stock.ticker.{ticker}` | ê°œë³„ ì¢…ëª© ì²´ê²°ê°€/í˜¸ê°€ (ì‹¤ì‹œê°„) | Trade í˜ì´ì§€ ì§„ì… ì‹œ êµ¬ë… |
| `/user/queue/trade` | ì‚¬ìš©ì ê°œì¸ ì£¼ë¬¸ ì²´ê²° ì•Œë¦¼ | ì „ì—­ êµ¬ë… |

**í† í”½ êµ¬ë… ì „ëµ**:
- **ë™ì  êµ¬ë…**: ì‚¬ìš©ìê°€ ì¢…ëª© ìƒì„¸ í˜ì´ì§€(`/trade`) ì§„ì… ì‹œì—ë§Œ í•´ë‹¹ ì¢…ëª© êµ¬ë…
- **LRU ê¸°ë°˜ í•´ì œ**: ë°±ì—”ë“œì—ì„œ Finnhub WebSocket 50 Symbols ì œí•œìœ¼ë¡œ ì¸í•´, í˜„ì¬ ì•„ë¬´ë„ ë³´ê³  ìˆì§€ ì•Šì€ ì¢…ëª©ì€ ìë™ìœ¼ë¡œ êµ¬ë… í•´ì œë¨
- **í”„ë¡ íŠ¸ì—”ë“œ ë™ì‘**: í˜ì´ì§€ ì´íƒˆ ì‹œ ëª…ì‹œì  êµ¬ë… í•´ì œ(`UNSUBSCRIBE`) ê¶Œì¥

### 10.3 STOMP ë©”ì‹œì§€ Payload ìŠ¤í‚¤ë§ˆ

#### `/topic/stock.indices` Payload

**ìŠ¤í‚¤ë§ˆ**: `MarketIndicesResponse` (REST APIì™€ ë™ì¼)

```json
{
  "items": [
    {
      "symbol": "SPY",
      "name": "S&P 500",
      "price": 4850.12,
      "change": 25.50,
      "changePercent": 0.53,
      "timestamp": 1705672800000
    },
    {
      "symbol": "QQQ",
      "name": "NASDAQ-100",
      "price": 4200.45,
      "change": -10.20,
      "changePercent": -0.24,
      "timestamp": 1705672800000
    },
    {
      "symbol": "DIA",
      "name": "Dow Jones",
      "price": 38000.00,
      "change": 150.00,
      "changePercent": 0.40,
      "timestamp": 1705672800000
    }
  ]
}
```

**ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì£¼ê¸°**: 10ì´ˆë§ˆë‹¤ (`@Scheduled(fixedDelay = 10000)`)

#### `/topic/stock.ticker.{ticker}` Payload

**ìŠ¤í‚¤ë§ˆ**:

```json
{
  "ticker": "string",
  "price": "number",
  "ts": "number",
  "volume": "number",
  "source": "string (optional)",
  "rawType": "string (optional)",
  "conditions": "string[] (optional)"
}
```

**í•„ë“œ ì„¤ëª…**:

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|-----|------|------|
| `ticker` | string | ì¢…ëª© ì‹¬ë³¼ (ì˜ˆ: `AAPL`, `BINANCE:BTCUSDT`, `IC MARKETS:1`) |
| `price` | number | ìµœì‹  ì²´ê²°ê°€ (Last Price) |
| `ts` | number | UNIX íƒ€ì„ìŠ¤íƒ¬í”„ (ë°€ë¦¬ì´ˆ) |
| `volume` | number | ê±°ë˜ëŸ‰ (trade ë¯¸ì§€ì› ì‹œ `0` ê°€ëŠ¥) |
| `source` | string (optional) | ë°ì´í„° ì¶œì²˜ (ê¸°ë³¸ê°’: `"FINNHUB"`) |
| `rawType` | string (optional) | Finnhub ì›ë³¸ ë©”ì‹œì§€ íƒ€ì… (ì˜ˆ: `"trade"`) |
| `conditions` | string[] (optional) | ê±°ë˜ ì¡°ê±´ ì½”ë“œ ë¦¬ìŠ¤íŠ¸ (Finnhub `c` í•„ë“œ) |

**ì˜ˆì‹œ JSON**:

```json
{
  "ticker": "AAPL",
  "price": 195.12,
  "ts": 1705672800000,
  "volume": 1000,
  "source": "FINNHUB",
  "rawType": "trade",
  "conditions": []
}
```

**Price Update (Trade ë¯¸ì§€ì› ì‹œ)**:

ì¼ë¶€ forex/crypto ê±°ë˜ì†Œì—ì„œëŠ” trade ë°ì´í„°ë¥¼ ì œê³µí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° `volume=0`ì¸ price updateê°€ ì „ì†¡ë©ë‹ˆë‹¤:

```json
{
  "ticker": "BINANCE:BTCUSDT",
  "price": 7296.89,
  "ts": 1705672800000,
  "volume": 0,
  "source": "FINNHUB",
  "rawType": "trade"
}
```

### 10.4 Ticker ì‹¬ë³¼ í˜•ì‹ ë° Destination ì•ˆì „ì„±

**ì§€ì›í•˜ëŠ” ì‹¬ë³¼ í˜•ì‹**:

- **US ì£¼ì‹**: `AAPL`, `MSFT`, `GOOGL` ë“±
- **Crypto**: `BINANCE:BTCUSDT`, `BINANCE:ETHUSDT` ë“±
- **Forex**: `IC MARKETS:1`, `OANDA:EUR_USD` ë“± (ê³µë°±/ì½œë¡  í¬í•¨ ê°€ëŠ¥)

**STOMP Destination ì²˜ë¦¬ ê·œì¹™**:

- **Destination íŒ¨í„´**: `/topic/stock.ticker.{ticker}`
- **í˜„ì¬ êµ¬í˜„ ì •ì±… (Phase 6)**: 
  - Ticker ë¬¸ìì—´ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤ (`StompDestinationUtils.createDestination()` ì‚¬ìš©)
  - ê³µë°±/íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ëœ ticker(ì˜ˆ: `IC MARKETS:1`)ì˜ ê²½ìš°, STOMP destinationì€ ê·¸ëŒ€ë¡œ `/topic/stock.ticker.IC MARKETS:1` í˜•ì‹ì´ ë©ë‹ˆë‹¤
  - í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ ëª¨ë‘ì—ì„œ ì´ í˜•ì‹ì„ ê·¸ëŒ€ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤
- **í–¥í›„ í™•ì¥ ê°€ëŠ¥ì„±**: 
  - URL ì¸ì½”ë”©ì´ í•„ìš”í•œ ê²½ìš° `StompDestinationUtils.createEncodedDestination()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
  - ì˜ˆ: `IC MARKETS:1` â†’ `/topic/stock.ticker.IC%20MARKETS%3A1`
  - í˜„ì¬ëŠ” ì¸ì½”ë”© ì—†ì´ ì‚¬ìš©í•˜ë©°, STOMP í”„ë¡œí† ì½œì´ ì´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤

#### `/user/queue/trade` Payload

**ìŠ¤í‚¤ë§ˆ**: `TradeNotificationDto`

```json
{
  "orderId": 12345,
  "ticker": "AAPL",
  "type": "BUY",
  "quantity": 10,
  "executedPrice": 195.12,
  "totalAmount": 1951.20,
  "realizedPnl": null,
  "executedAt": "2026-01-19T12:34:56",
  "status": "FILLED"
}
```

**í•„ë“œ ì„¤ëª…**:

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|-----|------|------|
| `orderId` | number | ê±°ë˜ ë¡œê·¸ ID (`TradeLog.logId`) |
| `ticker` | string | ì¢…ëª© ì½”ë“œ |
| `type` | string | ê±°ë˜ íƒ€ì… (`"BUY"` | `"SELL"`) |
| `quantity` | number | ì²´ê²° ìˆ˜ëŸ‰ |
| `executedPrice` | number | ì²´ê²° ê°€ê²© |
| `totalAmount` | number | ì´ ê±°ë˜ ê¸ˆì•¡ |
| `realizedPnl` | number \| null | ì‹¤í˜„ ì†ìµ (ë§¤ë„ ì‹œë§Œ, ë§¤ìˆ˜ ì‹œëŠ” `null`) |
| `executedAt` | string | ì²´ê²° ì‹œê° (ISO-8601) |
| `status` | string | ì²´ê²° ìƒíƒœ (`"FILLED"`, í–¥í›„ í™•ì¥: `PARTIALLY_FILLED` ë“±) |

**ë°œí–‰ ì‹œì **: `TradeService.executeBuyOrder()` ë˜ëŠ” `executeSellOrder()` ì„±ê³µ í›„, íŠ¸ëœì­ì…˜ ì»¤ë°‹ í›„

**ì˜ˆì‹œ (ë§¤ë„ ì‹œ)**:

```json
{
  "orderId": 12346,
  "ticker": "AAPL",
  "type": "SELL",
  "quantity": 5,
  "executedPrice": 200.00,
  "totalAmount": 1000.00,
  "realizedPnl": 24.40,
  "executedAt": "2026-01-19T12:35:10",
  "status": "FILLED"
}
```

### 10.5 Finnhub WebSocket ì œì•½ì‚¬í•­

#### êµ¬ë… ì œí•œ

- **ìµœëŒ€ ë™ì‹œ êµ¬ë…**: 50 Symbols
- **í•´ê²° ì „ëµ**: Dynamic Subscription Manager (LRU ê¸°ë°˜)ë¡œ ìë™ ê´€ë¦¬
  - 50ê°œ ì´ˆê³¼ ì‹œ ê°€ì¥ ì˜¤ë˜ëœ ë¹„í™œì„± ì¢…ëª©ì„ ìë™ í•´ì œ
  - ëª¨ë“  ì¢…ëª©ì´ í™œì„± ìƒíƒœë©´ ì‹ ê·œ êµ¬ë…ì„ ê±°ë¶€(Skip)

#### Trade ë¯¸ì§€ì› ê±°ë˜ì†Œ/ë¸Œë¡œì»¤

**Forex ë¸Œë¡œì»¤ (ìŠ¤íŠ¸ë¦¬ë° ë¯¸ì§€ì›)**:
- FXCM
- Forex.com
- FHFX

**ëŒ€ì²´ ë°©ë²•**: ìœ„ ë¸Œë¡œì»¤ì˜ ê²½ìš°, ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ëŒ€ì‹  ë‹¤ìŒ REST APIë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:
- Forex Candles API: `GET /api/v1/stock/candles/{ticker}`
- All Rates API: (í–¥í›„ êµ¬í˜„)

**Crypto/Forex Trade ë¯¸ì§€ì›**:
- ì¼ë¶€ ê±°ë˜ì†Œì—ì„œëŠ” trade ë°ì´í„°ë¥¼ ì œê³µí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ì´ ê²½ìš° `volume=0`ì¸ price updateê°€ ì „ì†¡ë©ë‹ˆë‹¤
- í´ë¼ì´ì–¸íŠ¸ëŠ” `volume=0`ì„ ê°ì§€í•˜ì—¬ "Price Update Only" ìƒíƒœë¡œ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

### 10.6 ë©”ì‹œì§€ ì²˜ë¦¬ íë¦„

```mermaid
sequenceDiagram
    participant Finnhub as Finnhub WS
    participant Backend as Backend (Spring)
    participant Redis as Redis Cache
    participant STOMP as STOMP Broker
    participant Frontend as Frontend Client
    
    Finnhub->>Backend: Trade Message (type:"trade", data[])
    Backend->>Backend: Parse & Normalize
    Backend->>Redis: SET stock:price:{ticker}
    Backend->>STOMP: SEND /topic/stock.ticker.{ticker}
    STOMP->>Frontend: STOMP MESSAGE (last price update)
```

**ì²˜ë¦¬ ë‹¨ê³„**:

1. **Finnhub WebSocket ìˆ˜ì‹ **: ë°±ì—”ë“œê°€ Finnhubì—ì„œ trade ë©”ì‹œì§€ ìˆ˜ì‹ 
2. **íŒŒì‹± ë° ì •ê·œí™”**: JSON íŒŒì‹± í›„ í‘œì¤€ payload í˜•ì‹ìœ¼ë¡œ ë³€í™˜
3. **Redis ìºì‹œ ì—…ë°ì´íŠ¸**: ìµœì‹ ê°€ë¥¼ `stock:price:{ticker}` í‚¤ë¡œ ì €ì¥
4. **STOMP ë¸Œë¡œë“œìºìŠ¤íŠ¸**: `/topic/stock.ticker.{ticker}` í† í”½ìœ¼ë¡œ ëª¨ë“  êµ¬ë…ìì—ê²Œ ì „ì†¡
5. **í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì‹ **: STOMP í´ë¼ì´ì–¸íŠ¸ê°€ ë©”ì‹œì§€ë¥¼ ë°›ì•„ UI ì—…ë°ì´íŠ¸

### 10.7 ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì—°ê²°

**ì—°ê²° ì‹¤íŒ¨ ì‹œ**:
- ë°±ì—”ë“œëŠ” **ì§€ìˆ˜ ë°±ì˜¤í”„(Exponential Backoff)** ì „ëµìœ¼ë¡œ ì¬ì—°ê²° ì‹œë„
- ì¬ì—°ê²° ì„±ê³µ ì‹œ í˜„ì¬ êµ¬ë… í’€ì˜ ëª¨ë“  ì‹¬ë³¼ì„ ìë™ìœ¼ë¡œ ì¬êµ¬ë…

**ë©”ì‹œì§€ íŒŒì‹± ì‹¤íŒ¨ ì‹œ**:
- ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì… ë˜ëŠ” ë¹ˆ `data` ë°°ì—´ì€ ë¬´ì‹œí•˜ê³  ë””ë²„ê·¸ ë¡œê·¸ë§Œ ê¸°ë¡
- íŒŒì‹± ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ë‹¤ë¥¸ ì •ìƒ ë©”ì‹œì§€ ì²˜ë¦¬ëŠ” ê³„ì† ì§„í–‰

**êµ¬ë… ì‹¤íŒ¨ ì‹œ**:
- 50 Symbols ì œí•œ ì´ˆê³¼ë¡œ ì‹ ê·œ êµ¬ë…ì´ ê±°ë¶€ë˜ë©´, í´ë¼ì´ì–¸íŠ¸ëŠ” ê¸°ì¡´ ë°ì´í„°(Redis ìºì‹œ ë˜ëŠ” REST API)ë¥¼ ì‚¬ìš©

---

## 13. ë°ì´í„° ì „ëµ (Phase 3+)

### 13.1 ì™¸ë¶€ API ì œí•œ ë° ëŒ€ì‘ ì „ëµ

**ìƒì„¸ ì „ëµ**: `docs/DATA_STRATEGY_PLAN.md` ì°¸ì¡°

#### 13.1.1 Finnhub API ì œí•œ

- **Candle (OHLCV) ë°ì´í„°**: Premium ì „ìš© (ë¬´ë£Œ í”Œëœ ë¯¸ì§€ì›)
- **WebSocket ì‹¤ì‹œê°„**: 50 Symbols ë™ì‹œ êµ¬ë… ì œí•œ
- **í•´ê²°**: EODHD APIë¡œ Historical Data ëŒ€ì²´, Dynamic Subscription Managerë¡œ êµ¬ë… ê´€ë¦¬

#### 13.1.2 EODHD API ì œí•œ

- **ì¼ì¼ í˜¸ì¶œ ì œí•œ**: 20íšŒ/ì¼ (ë§¤ìš° ì—„ê²©)
- **âš ï¸ ë¬´ë£Œ êµ¬ë… ì œí•œ**: **ìµœê·¼ 1ë…„ ë°ì´í„°ë§Œ ì œê³µ** (ë¬´ë£Œ í”Œëœ)
  - 1ë…„ ì´ì „ ë°ì´í„° ìš”ì²­ ì‹œ ê²½ê³  ë©”ì‹œì§€ë§Œ ë°˜í™˜ë  ìˆ˜ ìˆìŒ
  - ì‘ë‹µì—ì„œ `warning` í•„ë“œ ì²´í¬ ë° í•„í„°ë§ í•„ìš”
- **í•´ê²° ì „ëµ**:
  - DB ìºì‹±: `stock_candles` í…Œì´ë¸”ì— ë°ì´í„° ì €ì¥, API ì‘ë‹µì€ í•­ìƒ DBì—ì„œ ì œê³µ
  - Quota ê´€ë¦¬: `api_usage_logs` í…Œì´ë¸”ë¡œ ì¼ì¼ í˜¸ì¶œ íšŸìˆ˜ ì¶”ì 
  - ì—ëŸ¬ ì²˜ë¦¬: Quota ì´ˆê³¼ ì‹œ ê¸°ì¡´ ë°ì´í„°(Stale) ë°˜í™˜ ë˜ëŠ” 429 ì—ëŸ¬ ì‘ë‹µ
  - ê²½ê³  ë©”ì‹œì§€ ì²˜ë¦¬: `warning` í•„ë“œê°€ ìˆëŠ” ì‘ë‹µì€ í•„í„°ë§í•˜ì—¬ ìœ íš¨í•œ ìº”ë“¤ ë°ì´í„°ë§Œ ì €ì¥
  - ì´ˆê¸° êµ¬ì¶•: ì„œë²„ ì‹œì‘ ì‹œì ì´ ì•„ë‹ˆë¼ "ìµœì´ˆ ìš”ì²­ ì‹œ" ë˜ëŠ” "ê´€ë¦¬ì íŠ¸ë¦¬ê±°"ë¡œ ì¸ê¸° ì¢…ëª©(Top 10)ë§Œ ìš°ì„  ì ì¬

#### 13.1.3 Market Movers ìºì‹± (êµ¬í˜„ ì™„ë£Œ)

- **Redis ìºì‹±**: `MarketService.getMovers()` ê²°ê³¼ë¥¼ Redisì— 1ë¶„~5ë¶„ê°„ ìºì‹±

#### 13.1.4 ë°±ì—”ë“œ Redis ìºì‹± í™•ì¥ (Phase 3.6) ğŸ†•

**ëª©í‘œ**: Market Indices, News, Moversì— ëŒ€í•œ Redis ìºì‹±ì„ í™•ì¥í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œ localStorage ìºì‹±ê³¼ ì´ì¤‘ ìºì‹± ì „ëµ ìˆ˜ë¦½

**ìºì‹œ ì „ëµ**:

1. **Redis ìºì‹œ í‚¤ ë° TTL**:
   - `market:indices` - TTL: 1ë¶„ (60ì´ˆ)
   - `market:news` - TTL: 5ë¶„ (300ì´ˆ)
   - `market:movers` - TTL: 1-5ë¶„ (ê¸°ì¡´ êµ¬í˜„ ìœ ì§€)

2. **Stale ë°ì´í„° ë°±ì—…**:
   - TTL ë§Œë£Œ í›„ì—ë„ `market:{type}:stale` í‚¤ë¡œ ì¶”ê°€ ì €ì¥ (TTL: 1ì‹œê°„)
   - API ì‹¤íŒ¨ ì‹œ Stale ë°ì´í„° ë°˜í™˜í•˜ì—¬ ì„œë¹„ìŠ¤ ì§€ì†ì„± ë³´ì¥

3. **ì‘ë‹µ í—¤ë”**:
   - `X-Cache-Status`: `HIT` (ìºì‹œ Hit), `MISS` (API í˜¸ì¶œ), `STALE` (ë§Œë£Œ ë°ì´í„° ì‚¬ìš©)
   - `X-Cache-Age`: ìºì‹œ ìƒì„± í›„ ê²½ê³¼ ì‹œê°„ (ì´ˆ)
   - `X-Data-Freshness`: `FRESH` (ìµœì‹ ), `STALE` (ë§Œë£Œë˜ì—ˆì§€ë§Œ ì‚¬ìš© ê°€ëŠ¥), `EXPIRED` (ë§Œë£Œ)

4. **í”„ë¡ íŠ¸ì—”ë“œ ì—°ê³„**:
   - í”„ë¡ íŠ¸ì—”ë“œëŠ” `X-Cache-Status` í—¤ë”ë¥¼ í™•ì¸í•˜ì—¬ ìºì‹œ ìƒíƒœ í‘œì‹œ
   - ë°±ì—”ë“œ Redis ìºì‹œì™€ í”„ë¡ íŠ¸ì—”ë“œ localStorage ìºì‹œì˜ ì´ì¤‘ ë³´í˜¸
   - ë°±ì—”ë“œì—ì„œ Stale ë°ì´í„°ë¥¼ ë°˜í™˜í•´ë„ í”„ë¡ íŠ¸ì—”ë“œëŠ” í‘œì‹œ ê°€ëŠ¥

**ë°ì´í„° íë¦„**:
```mermaid
sequenceDiagram
    participant Frontend as í”„ë¡ íŠ¸ì—”ë“œ
    participant Backend as ë°±ì—”ë“œ
    participant Redis as Redis Cache
    participant API as ì™¸ë¶€ API (Finnhub)
    
    Frontend->>Backend: GET /api/v1/market/indices
    Backend->>Redis: GET market:indices
    alt Cache Hit
        Redis-->>Backend: ìºì‹œëœ ë°ì´í„°
        Backend-->>Frontend: 200 OK + X-Cache-Status: HIT
    else Cache Miss
        Backend->>API: API í˜¸ì¶œ
        alt API Success
            API-->>Backend: ìµœì‹  ë°ì´í„°
            Backend->>Redis: SET market:indices (TTL: 1ë¶„)
            Backend->>Redis: SET market:indices:stale (TTL: 1ì‹œê°„)
            Backend-->>Frontend: 200 OK + X-Cache-Status: MISS
        else API Failure
            Backend->>Redis: GET market:indices:stale
            alt Stale Cache Exists
                Redis-->>Backend: Stale ë°ì´í„°
                Backend-->>Frontend: 200 OK + X-Cache-Status: STALE
            else No Stale Cache
                Backend-->>Frontend: 500 Internal Server Error
            end
        end
    end
    Frontend->>Frontend: localStorageì— ì €ì¥ (í”„ë¡ íŠ¸ì—”ë“œ ìºì‹œ)
```
- **DB ê´€ë¦¬**: `Top 20 Market Cap` ë¦¬ìŠ¤íŠ¸ë¥¼ `market_cap_stocks` í…Œì´ë¸”ë¡œ ê´€ë¦¬ (Flyway V6)
  - Entity: `MarketCapStock` (`symbol`, `company_name`, `market_cap_rank`, `is_active`)
  - Repository: `MarketCapStockRepository.findByIsActiveTrueOrderByMarketCapRankAsc()`
  - ì´ˆê¸° ë°ì´í„°: 20ê°œ ì¢…ëª© ì‹œë“œ (2026-01-19 ê¸°ì¤€)
    - ìƒìœ„ 20ê°œ: `AAPL`, `MSFT`, `GOOGL`, `AMZN`, `NVDA`, `META`, `TSLA`, `BRK.B`, `V`, `UNH`, `JNJ`, `WMT`, `JPM`, `MA`, `PG`, `HD`, `DIS`, `AVGO`, `PEP`, `COST`
  - Fallback: DBì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ í•˜ë“œì½”ë”© ë¦¬ìŠ¤íŠ¸(10ê°œ ì¢…ëª©) ì‚¬ìš©
  - ì¢…ëª©ëª… ì¡°íšŒ: DBì˜ `company_name` ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ Search APIë¡œ ì¡°íšŒ
  - **ë°ì´í„° íë¦„**:
    ```mermaid
    flowchart TD
        A[GET /api/v1/market/movers] --> B[MarketService.getMovers]
        B --> C{DBì— ë°ì´í„° ìˆìŒ?}
        C -->|Yes| D[MarketCapStockRepository ì¡°íšŒ]
        C -->|No| E[Fallback: í•˜ë“œì½”ë”© ë¦¬ìŠ¤íŠ¸]
        D --> F[í™œì„±í™”ëœ ì¢…ëª© 20ê°œ ì¡°íšŒ]
        E --> G[ê¸°ì¡´ 10ê°œ ì¢…ëª©]
        F --> H[ê° ì¢…ëª© Quote API í˜¸ì¶œ]
        G --> H
        H --> I[changePercent ê¸°ì¤€ ì •ë ¬]
        I --> J[ìƒìœ„ 5ê°œ ë°˜í™˜]
        J --> K[MarketMoversResponse]
    ```

### 13.2 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥

#### market_cap_stocks (Flyway V6)

```sql
CREATE TABLE market_cap_stocks (
    id BIGSERIAL PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL UNIQUE,
    company_name VARCHAR(200),
    market_cap_rank INTEGER NOT NULL, -- 1~20 ìˆœìœ„
    is_active BOOLEAN DEFAULT TRUE,    -- í™œì„±í™” ì—¬ë¶€
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_market_cap_stocks_rank ON market_cap_stocks(market_cap_rank);
CREATE INDEX idx_market_cap_stocks_active ON market_cap_stocks(is_active) WHERE is_active = TRUE;
```

**ì„¤ê³„ ì›ì¹™**:
- `symbol`: ì¢…ëª© ì‹¬ë³¼ (UNIQUE ì œì•½)
- `market_cap_rank`: ì‹œê°€ì´ì•¡ ìˆœìœ„ (1~20)
- `is_active`: í™œì„±í™” ì—¬ë¶€ (í–¥í›„ ê´€ë¦¬ ê¸°ëŠ¥ í™•ì¥ ëŒ€ë¹„)
- ì¸ë±ìŠ¤: ìˆœìœ„ ë° í™œì„±í™” ì—¬ë¶€ ê¸°ì¤€ ì¡°íšŒ ìµœì í™”

**ì´ˆê¸° ë°ì´í„°**: Top 20 Market Cap ì¢…ëª© (2026-01-19 ê¸°ì¤€)
- ì‹œê°€ì´ì•¡ ìˆœìœ„ëŠ” ë³€ë™ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í–¥í›„ ê´€ë¦¬ì APIë¡œ ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„

**í–¥í›„ í™•ì¥ ê°€ëŠ¥ì„±** (Phase 9 ê³„íš):
1. **ê´€ë¦¬ì API**: ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì—”ë“œí¬ì¸íŠ¸ (Phase 9.1)
2. **ìë™ ê°±ì‹ **: ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ì‹œê°€ì´ì•¡ ìˆœìœ„ ìë™ ì—…ë°ì´íŠ¸ (Phase 9.2)
3. **ë‹¤ë¥¸ ì‹œì¥**: í•œêµ­/ì¼ë³¸ ë“± ë‹¤ë¥¸ ì‹œì¥ì˜ Top 20 ì¶”ê°€ (Phase 9.3)

#### stock_candles (Flyway V5)

```sql
CREATE TABLE stock_candles (
    symbol VARCHAR(20) NOT NULL,
    date DATE NOT NULL,
    open DOUBLE PRECISION NOT NULL,
    high DOUBLE PRECISION NOT NULL,
    low DOUBLE PRECISION NOT NULL,
    close DOUBLE PRECISION NOT NULL,
    volume BIGINT NOT NULL,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (symbol, date)
);
```

#### api_usage_logs (Flyway V5)

```sql
CREATE TABLE api_usage_logs (
    id BIGSERIAL PRIMARY KEY,
    provider VARCHAR(20) NOT NULL,  -- 'EODHD'
    call_date DATE NOT NULL,
    count INTEGER NOT NULL DEFAULT 0,
    UNIQUE (provider, call_date)
);
```

### 13.3 ì™¸ë¶€ API í™•ì¥ ì „ëµ (í–¥í›„ ê°œì„ )

í˜„ì¬ EODHD APIëŠ” ë¬´ë£Œ êµ¬ë… ì œí•œ(ìµœê·¼ 1ë…„ ë°ì´í„°ë§Œ ì œê³µ)ê³¼ ì¼ì¼ í˜¸ì¶œ ì œí•œ(20íšŒ)ì´ ìˆì–´, ì¥ê¸°ì ì¸ ë°ì´í„° ì œê³µì— í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.

**í™•ì¥ ë°©í–¥**:
1. **ë‹¤ì¤‘ API Provider ì „ëµ**:
   - EODHD ì™¸ì— ë‹¤ë¥¸ ë¬´ë£Œ/ìœ ë£Œ Historical Data APIë¥¼ ì¶”ê°€ë¡œ ì—°ë™
   - ì˜ˆ: Alpha Vantage, Yahoo Finance (ë¹„ê³µì‹), Polygon.io ë“±
   - Providerë³„ Quotaë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³ , ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ìë™ ì „í™˜

2. **API Provider ì¶”ìƒí™”**:
   - `HistoricalDataProvider` ì¸í„°í˜ì´ìŠ¤ ë„ì…
   - `EodhdProvider`, `AlphaVantageProvider` ë“± êµ¬í˜„ì²´ë¡œ ë¶„ë¦¬
   - `ProviderManager`ì—ì„œ Quota ìƒíƒœì— ë”°ë¼ ìë™ìœ¼ë¡œ Provider ì„ íƒ

3. **ë°ì´í„° ë³‘í•© ì „ëµ**:
   - ì—¬ëŸ¬ Providerì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ `stock_candles` í…Œì´ë¸”ì— ë³‘í•©
   - ì¤‘ë³µ ë°ì´í„°ëŠ” `last_updated`ê°€ ìµœì‹ ì¸ ê²ƒì„ ìš°ì„ 
   - Providerë³„ ì‹ ë¢°ë„ ì ìˆ˜ ê¸°ë°˜ ê°€ì¤‘ì¹˜ ì ìš© ê°€ëŠ¥

4. **Fallback ë©”ì»¤ë‹ˆì¦˜**:
   - Primary Provider (EODHD) Quota ì´ˆê³¼ ì‹œ â†’ Secondary Providerë¡œ ìë™ ì „í™˜
   - ëª¨ë“  Provider Quota ì´ˆê³¼ ì‹œ â†’ DBì— ì €ì¥ëœ ê¸°ì¡´ ë°ì´í„° ë°˜í™˜ (Stale í‘œì‹œ)

5. **ë°ì´í„° ìˆ˜ì§‘ ìµœì í™”**:
   - ì¸ê¸° ì¢…ëª©ì€ ì—¬ëŸ¬ Providerì—ì„œ ìˆ˜ì§‘í•˜ì—¬ ë°ì´í„° ì™„ì„±ë„ í–¥ìƒ
   - ë¹„ì¸ê¸° ì¢…ëª©ì€ Primary Providerë§Œ ì‚¬ìš©í•˜ì—¬ Quota ì ˆì•½

**êµ¬í˜„ ìš°ì„ ìˆœìœ„**:
- Phase 8.1: `HistoricalDataProvider` ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„ ë° EODHDë¥¼ Providerë¡œ ë¦¬íŒ©í† ë§
- Phase 8.2: Alpha Vantage ë˜ëŠ” ë‹¤ë¥¸ ë¬´ë£Œ API Provider ì¶”ê°€ êµ¬í˜„
- Phase 8.3: `ProviderManager` êµ¬í˜„ ë° ìë™ ì „í™˜ ë¡œì§
- Phase 8.4: ë°ì´í„° ë³‘í•© ë° Fallback ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„

### 13.4 Market Movers ê´€ë¦¬ ê¸°ëŠ¥ (í–¥í›„ ê°œì„ )

í˜„ì¬ `market_cap_stocks` í…Œì´ë¸”ì˜ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ëŠ” ì´ˆê¸° ë°ì´í„°ë¡œë§Œ ê´€ë¦¬ë˜ê³  ìˆìœ¼ë©°, ì‹œê°€ì´ì•¡ ìˆœìœ„ëŠ” ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**êµ¬í˜„ ë°©í–¥**:
1. **ê´€ë¦¬ì API**: ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì—”ë“œí¬ì¸íŠ¸
   - `POST /api/v1/admin/market-cap-stocks`: ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì¼ê´„ ì—…ë°ì´íŠ¸
   - `PUT /api/v1/admin/market-cap-stocks/{id}`: ê°œë³„ ì¢…ëª© ìˆ˜ì • (ìˆœìœ„, í™œì„±í™” ì—¬ë¶€ ë“±)
   - `DELETE /api/v1/admin/market-cap-stocks/{id}`: ì¢…ëª© ì‚­ì œ (ë¹„í™œì„±í™”)
   - ì¸ì¦: ê´€ë¦¬ì ê¶Œí•œ í•„ìš” (ROLE_ADMIN)
   
2. **ìë™ ê°±ì‹ **: ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ì‹œê°€ì´ì•¡ ìˆœìœ„ ìë™ ì—…ë°ì´íŠ¸
   - Spring `@Scheduled` ë˜ëŠ” Quartz ìŠ¤ì¼€ì¤„ëŸ¬ ì‚¬ìš©
   - ì£¼ê¸°: ì¼ì¼ 1íšŒ (ì¥ ë§ˆê° í›„, ì˜ˆ: ì˜¤í›„ 6ì‹œ)
   - ì™¸ë¶€ API í™œìš©: Finnhub ë˜ëŠ” ë‹¤ë¥¸ APIë¡œ ì‹œê°€ì´ì•¡ ìˆœìœ„ ì¡°íšŒ
   - ì—…ë°ì´íŠ¸ ì „ëµ: ê¸°ì¡´ ì¢…ëª© ìˆœìœ„ ê°±ì‹  + ì‹ ê·œ ì¢…ëª© ì¶”ê°€ (ìƒìœ„ 20ê°œ ìœ ì§€)
   - ì—ëŸ¬ ì²˜ë¦¬: API ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ë°ì´í„° ìœ ì§€, ë¡œê·¸ ê¸°ë¡

**êµ¬í˜„ ìš°ì„ ìˆœìœ„**:
- Phase 9.1: ê´€ë¦¬ì API êµ¬í˜„ (ì¸ì¦/ì¸ê°€ í¬í•¨)
- Phase 9.2: ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„ ë° ì™¸ë¶€ API ì—°ë™
- Phase 9.3: ìë™ ê°±ì‹  ë¡œì§ ë° ì—ëŸ¬ ì²˜ë¦¬

---

---

## 14. êµ¬í˜„ ì™„ë£Œ í˜„í™© (Phase 3.5: Market Movers DB ê´€ë¦¬)

### 14.1 Market Movers Top 20 Market Cap DB ê´€ë¦¬ (êµ¬í˜„ ì™„ë£Œ)

**êµ¬í˜„ ì¼ì**: 2026-01-19

**êµ¬í˜„ ë‚´ìš©**:
- âœ… Flyway V6 ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„± (`V6__create_market_cap_stocks.sql`)
- âœ… `MarketCapStock` Entity ìƒì„±
- âœ… `MarketCapStockRepository` ìƒì„±
- âœ… `MarketService.getMovers()` ìˆ˜ì • (DB ì¡°íšŒ ë¡œì§ + Fallback)
- âœ… ì´ˆê¸° ë°ì´í„° ì‹œë“œ (20ê°œ ì¢…ëª©)
- âœ… ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ

**ê²€ì¦ ì™„ë£Œ**:
- âœ… DB ìŠ¤í‚¤ë§ˆ: `market_cap_stocks` í…Œì´ë¸” ìƒì„± ë° ì¸ë±ìŠ¤ ì„¤ì •
- âœ… Entity: ëª¨ë“  í•„ë“œ ì •ìƒ ë§¤í•‘ (`symbol`, `company_name`, `market_cap_rank`, `is_active`)
- âœ… Repository: `findByIsActiveTrueOrderByMarketCapRankAsc()` ë©”ì„œë“œ êµ¬í˜„
- âœ… Service: DB ì¡°íšŒ ë¡œì§ ë° Fallback ë¡œì§ êµ¬í˜„
- âœ… ì¢…ëª©ëª… ì¡°íšŒ: DBì˜ `company_name` ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ Search API ì‚¬ìš©
- âœ… API ì‘ë‹µ í˜•ì‹: ê¸°ì¡´ê³¼ ë™ì¼ (`MarketMoversResponse`)

**ì°¸ê³ ì‚¬í•­**:
- API ì‘ë‹µ í˜•ì‹ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ë¯€ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ ë¶ˆí•„ìš”
- í•˜ìœ„ í˜¸í™˜ì„±: DBì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ í•˜ë“œì½”ë”© ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©
- ì´ˆê¸° ë°ì´í„°ëŠ” ë¯¸êµ­ ì£¼ì‹ ì‹œì¥ ê¸°ì¤€ (ë¬¸ì„œì™€ ì¼ì¹˜)

---

**ë¬¸ì„œ ë²„ì „:** 2.7.13 (Phase 6: ì‹¤ì‹œê°„ í†µì‹  ìŠ¤í™ ì¶”ê°€ ë° Finnhub WebSocket ì œì•½ì‚¬í•­ ì •í•©í™”)  
**ìµœì¢… ìˆ˜ì •ì¼:** 2026-01-19
